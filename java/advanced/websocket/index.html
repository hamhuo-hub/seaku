<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>WebSocket | 海阔集</title>
<meta name="description" content="HTTP只能单向向服务器请求, 如果要实现服务器通知, 就必须由客户端轮询, 压力非常大. 并且HTTP会携带无效信息, 延迟很高
因此出现了WebSocket">
<meta property="og:url" content="https://hamhuo.xyz/java/advanced/websocket/">
  <meta property="og:site_name" content="海阔集">
  <meta property="og:title" content="WebSocket">
  <meta property="og:description" content="HTTP只能单向向服务器请求, 如果要实现服务器通知, 就必须由客户端轮询, 压力非常大. 并且HTTP会携带无效信息, 延迟很高
因此出现了WebSocket">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="java">
    <meta property="article:modified_time" content="2025-03-03T04:12:40+08:00">
    <meta property="article:tag" content="JavaWeb">

  <meta itemprop="name" content="WebSocket">
  <meta itemprop="description" content="HTTP只能单向向服务器请求, 如果要实现服务器通知, 就必须由客户端轮询, 压力非常大. 并且HTTP会携带无效信息, 延迟很高
因此出现了WebSocket">
  <meta itemprop="dateModified" content="2025-03-03T04:12:40+08:00">
  <meta itemprop="wordCount" content="584">
  <meta itemprop="keywords" content="JavaWeb">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="WebSocket">
  <meta name="twitter:description" content="HTTP只能单向向服务器请求, 如果要实现服务器通知, 就必须由客户端轮询, 压力非常大. 并且HTTP会携带无效信息, 延迟很高
因此出现了WebSocket">
<link rel="preload" href="/scss/main.min.6c18e25eadfb13d8abc6b872960e12aab94122cfeded66e3b312c962ee366f20.css" as="style" integrity="sha256-bBjiXq37E9irxrhylg4SqrlBIs/t7WbjsxLJYu42byA=" crossorigin="anonymous">
<link href="/scss/main.min.6c18e25eadfb13d8abc6b872960e12aab94122cfeded66e3b312c962ee366f20.css" rel="stylesheet" integrity="sha256-bBjiXq37E9irxrhylg4SqrlBIs/t7WbjsxLJYu42byA=" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-page">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="800" height="800" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23.3 8.40007 21.82 6.40008C21.7248 6.27314 21.6008 6.17066 21.4583 6.10111 21.3157 6.03156 21.1586 5.99693 21 6.00008H11.2C11.0555 6.00007 10.9128 6.03135 10.7816 6.09177 10.6504 6.15219 10.5339 6.24031 10.44 6.35007L8.71998 8.35008C8.57227 8.53401 8.49435 8.76424 8.49998 9.00008V16.2901C8.50262 18.0317 9.19567 19.7013 10.4272 20.9328c1.2316 1.2316 2.9011 1.9246 4.6428 1.9273h1.86C18.6716 22.8574 20.3412 22.1644 21.5728 20.9328c1.2315-1.2315 1.9245-2.9011 1.9272-4.6427V9.00008C23.5 8.7837 23.4298 8.57317 23.3 8.40007z" fill="#ffcc80"/><path d="M29.78 28.38l-4-5C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38z" fill="#01579b"/><path d="M29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344L15.73 11.6C15.906 11.6534 16.094 11.6534 16.27 11.6l13-3.59997C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003z" fill="#01579b"/><path d="M11.22 6C11.0756 5.99999 10.9328 6.03127 10.8016 6.09169 10.6704 6.15211 10.5539 6.24023 10.46 6.35l-1.72 2C8.58509 8.53114 8.49998 8.76166 8.5 9v7.29C8.50264 18.0317 9.19569 19.7012 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272H16V6H11.22z" fill="#ffe0b2"/><path d="M7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H16V25L7.21999 23z" fill="#0277bd"/><path d="M15.71 2.00002l-13 4C2.49742 6.06422 2.31226 6.19734 2.1837 6.3784c-.12855.18107-.19318.39977-.1837.62162C1.9917 7.22447 2.0592 7.44518 2.19163 7.62658 2.32405 7.80799 2.5137 7.93954 2.73 8.00002L15.73 11.6C15.8194 11.6146 15.9106 11.6146 16 11.6V2.00002C15.9039 1.98469 15.8061 1.98469 15.71 2.00002z" fill="#0277bd"/><path d="M2.73 8.00003l5.77 1.56V16.29C8.50264 18.0317 9.19569 19.7013 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272h1.86C18.6717 22.8574 20.3412 22.1643 21.5728 20.9328c1.2315-1.2315 1.9246-2.9011 1.9272-4.6428V9.56003l5.77-1.56C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344zM21.5 16.29C21.4974 17.5013 21.015 18.6621 20.1586 19.5186 19.3021 20.3751 18.1412 20.8574 16.93 20.86H15.07C13.8588 20.8574 12.6979 20.3751 11.8414 19.5186 10.985 18.6621 10.5026 17.5013 10.5 16.29V10.11l5.23 1.45C15.906 11.6134 16.094 11.6134 16.27 11.56l5.23-1.45v6.18zM16 4.05003l9.44 2.95-9.44 2.56-9.44-2.56 9.44-2.95z" fill="#263238"/><path d="M25.78 23.38C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38l-4-5zM5.07999 28l2.31-2.89L15.78 27C15.9251 27.0299 16.0748 27.0299 16.22 27l8.39-1.87L26.92 28H5.07999z" fill="#263238"/></svg></span><span class="navbar-brand__name">海阔集</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/leetcode/"><span>Alog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/java/"><span>Doc</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/graphicsai/"><span>Graphics and AI</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/interview/"><span>Interview</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/graphicsai/torch/"><span>Pytorch basics tutorials</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/school/"><span>课程归档</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.313b3383fe617c10d9f0d7f88142b658.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.313b3383fe617c10d9f0d7f88142b658.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="td-sidebar-nav collapse" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-java-li">
  <a href="/java/" title="Documents" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-java"><span class="">Doc</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasic-li">
  <a href="/java/basic/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasic"><span class="">Java基础能力</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicdocker-li">
  <a href="/java/basic/docker/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicdocker"><span class="">Docker</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicjavaweb-li">
  <a href="/java/basic/javaweb/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicjavaweb"><span class="">JavaWeb</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicjavawebservlet-li">
  <a href="/java/basic/javaweb/servlet/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicjavawebservlet"><span class="">Servlet</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicconcurrent-li">
  <a href="/java/basic/concurrent/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicconcurrent"><span class="">Java并发编程</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentaqs-li">
  <a href="/java/basic/concurrent/aqs/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentaqs"><span class="">AQS</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentrunvsstart-li">
  <a href="/java/basic/concurrent/runvsstart/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentrunvsstart"><span class="">Difference between run() and start()</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentjmme58685e5ad98e6a8a1e59e8b-li">
  <a href="/java/basic/concurrent/jmm%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentjmme58685e5ad98e6a8a1e59e8b"><span class="">JMM内存模型</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicconcurrentliveness-li">
  <a href="/java/basic/concurrent/liveness/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicconcurrentliveness"><span class="">Liveness</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentlivenessdeadlock-li">
  <a href="/java/basic/concurrent/liveness/deadlock/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentlivenessdeadlock"><span class="">deadlock</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicconcurrentsynchronization-li">
  <a href="/java/basic/concurrent/synchronization/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicconcurrentsynchronization"><span class="">synchronized</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentsynchronizationatomic-li">
  <a href="/java/basic/concurrent/synchronization/atomic/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentsynchronizationatomic"><span class="">atomic</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentsynchronizationmemconsist-li">
  <a href="/java/basic/concurrent/synchronization/memconsist/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentsynchronizationmemconsist"><span class="">Memory Consistency Errors</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentsynchronizationreadwritelock-li">
  <a href="/java/basic/concurrent/synchronization/readwritelock/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentsynchronizationreadwritelock"><span class="">ReadWriteLock</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentsynchronizationreentrantlocke9878de585a5e99481-li">
  <a href="/java/basic/concurrent/synchronization/reentrantlock%E9%87%8D%E5%85%A5%E9%94%81/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentsynchronizationreentrantlocke9878de585a5e99481"><span class="">ReentrantLock重入锁</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicconcurrentthreadobjects-li">
  <a href="/java/basic/concurrent/threadobjects/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicconcurrentthreadobjects"><span class="">Thread Objects</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentthreadobjectsprocthread-li">
  <a href="/java/basic/concurrent/threadobjects/procthread/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentthreadobjectsprocthread"><span class="">多线程入门</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentthreadobjectse7babfe7a88be4b88ee8bf9be7a88b-li">
  <a href="/java/basic/concurrent/threadobjects/%E7%BA%BF%E7%A8%8B%E4%B8%8E%E8%BF%9B%E7%A8%8B/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentthreadobjectse7babfe7a88be4b88ee8bf9be7a88b"><span class="">线程</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentthreadobjectse7babfe7a88be7949fe591bde591a8e69c9f-li">
  <a href="/java/basic/concurrent/threadobjects/%E7%BA%BF%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentthreadobjectse7babfe7a88be7949fe591bde591a8e69c9f"><span class="">线程生命周期</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentthreadlocal-li">
  <a href="/java/basic/concurrent/threadlocal/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentthreadlocal"><span class="">ThreadLocal</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentvolatilee585b3e994aee5ad97-li">
  <a href="/java/basic/concurrent/volatile%E5%85%B3%E9%94%AE%E5%AD%97/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentvolatilee585b3e994aee5ad97"><span class="">volatile关键字</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrente7babfe7a88be6b1a0-li">
  <a href="/java/basic/concurrent/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrente7babfe7a88be6b1a0"><span class="">线程池</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrente887aae6978be99481e4b88eclhe99481-li">
  <a href="/java/basic/concurrent/%E8%87%AA%E6%97%8B%E9%94%81%E4%B8%8Eclh%E9%94%81/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrente887aae6978be99481e4b88eclhe99481"><span class="">自旋锁与CLH锁</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrente88eb7e58f96e7babfe7a88be689a7e8a18ce7bb93e69e9c-li">
  <a href="/java/basic/concurrent/%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrente88eb7e58f96e7babfe7a88be689a7e8a18ce7bb93e69e9c"><span class="">获取线程执行结果</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrente9809ae4bfa1e5b7a5e585b7e7b1bb-li">
  <a href="/java/basic/concurrent/%E9%80%9A%E4%BF%A1%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrente9809ae4bfa1e5b7a5e585b7e7b1bb"><span class="">通信工具类</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrentconditione7ad89e5be85e9809ae79fa5e69da1e4bbb6-li">
  <a href="/java/basic/concurrent/condition%E7%AD%89%E5%BE%85%E9%80%9A%E7%9F%A5%E6%9D%A1%E4%BB%B6/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrentconditione7ad89e5be85e9809ae79fa5e69da1e4bbb6"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrente7babfe7a88be998bbe5a19ee4b88ee594a4e98692-li">
  <a href="/java/basic/concurrent/%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E%E4%B8%8E%E5%94%A4%E9%86%92/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrente7babfe7a88be998bbe5a19ee4b88ee594a4e98692"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicconcurrente998bbe5a19ee9989fe58897-li">
  <a href="/java/basic/concurrent/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicconcurrente998bbe5a19ee9989fe58897"><span class=""></span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicjavae695b0e68daee7b1bbe59e8b-li">
  <a href="/java/basic/java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicjavae695b0e68daee7b1bbe59e8b"><span class="">Java数据类型</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasiccontainer-li">
  <a href="/java/basic/container/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasiccontainer"><span class="">Java集合框架</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasiccontainerlinkedlist-li">
  <a href="/java/basic/container/linkedlist/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasiccontainerlinkedlist"><span class="">LinkedList</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasiccontainerheap-li">
  <a href="/java/basic/container/heap/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasiccontainerheap"><span class=""></span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicjvm-li">
  <a href="/java/basic/jvm/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicjvm"><span class="">JVM</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicjvmjavae79a84e59b9be7a78de5bc95e794a8-li">
  <a href="/java/basic/jvm/java%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicjvmjavae79a84e59b9be7a78de5bc95e794a8"><span class="">Java的四种引用</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javabasicmysql-li">
  <a href="/java/basic/mysql/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javabasicmysql"><span class="">MySQL</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle5ad97e7aca6e99b86e5928ce6af94e8be83e8a784e58899-li">
  <a href="/java/basic/mysql/mysql%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%AF%94%E8%BE%83%E8%A7%84%E5%88%99/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle5ad97e7aca6e99b86e5928ce6af94e8be83e8a784e58899"><span class="">MySQL字符集和比较规则</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle695b0e68daee5ba93e6938de4bd9c-li">
  <a href="/java/basic/mysql/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle695b0e68daee5ba93e6938de4bd9c"><span class="">MySQL数据库操作</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle695b0e68daee5ba93e7ae80e58d95e69fa5e8afa2-li">
  <a href="/java/basic/mysql/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle695b0e68daee5ba93e7ae80e58d95e69fa5e8afa2"><span class="">MySQL数据库查询</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle695b0e68daee7b1bbe59e8b-li">
  <a href="/java/basic/mysql/mysql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle695b0e68daee7b1bbe59e8b"><span class="">MySQL数据类型</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle69da1e4bbb6e69fa5e8afa2-li">
  <a href="/java/basic/mysql/mysql%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle69da1e4bbb6e69fa5e8afa2"><span class="">MySQL条件查询</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle7b4a2e5bc95-li">
  <a href="/java/basic/mysql/mysql%E7%B4%A2%E5%BC%95/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle7b4a2e5bc95"><span class="">MySQL索引</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle8a1a8e5a29ee588a0e694b9e69fa5-li">
  <a href="/java/basic/mysql/mysql%E8%A1%A8%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle8a1a8e5a29ee588a0e694b9e69fa5"><span class="">MySQL表操作</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqlmysqle8bf9ee68ea5-li">
  <a href="/java/basic/mysql/mysql%E8%BF%9E%E6%8E%A5/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqlmysqle8bf9ee68ea5"><span class="">MySQL连接</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqle4ba8be58aa1-li">
  <a href="/java/basic/mysql/%E4%BA%8B%E5%8A%A1/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqle4ba8be58aa1"><span class="">事务</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicmysqle695b0e68daee5ba93e8aebee8aea1e8a784e88c83-li">
  <a href="/java/basic/mysql/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicmysqle695b0e68daee5ba93e8aebee8aea1e8a784e88c83"><span class="">数据库设计规范</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicdesignpatternse5b7a5e58e82e696b9e6b395-li">
  <a href="/java/basic/designpatterns/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicdesignpatternse5b7a5e58e82e696b9e6b395"><span class="">工厂方法</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasicdesignpatternse6a8a1e69dbfe696b9e6b395-li">
  <a href="/java/basic/designpatterns/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasicdesignpatternse6a8a1e69dbfe696b9e6b395"><span class="">模板方法</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javabasice9809ae9858de7aca6-li">
  <a href="/java/basic/%E9%80%9A%E9%85%8D%E7%AC%A6/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javabasice9809ae9858de7aca6"><span class="">通配符</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-javaadvanced-li">
  <a href="/java/advanced/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javaadvanced"><span class="">Java进阶能力</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javaadvancedfastdfs-li">
  <a href="/java/advanced/fastdfs/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javaadvancedfastdfs"><span class=""></span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedfastdfsfastdfse58886e5b883e5bc8fe5ad98e582a8-li">
  <a href="/java/advanced/fastdfs/fastdfs%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedfastdfsfastdfse58886e5b883e5bc8fe5ad98e582a8"><span class="">FastDFS分布式存储</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-javaadvancedrocktmq-li">
  <a href="/java/advanced/rocktmq/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-javaadvancedrocktmq"><span class=""></span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedrocktmqrocketmqe6b688e681afe9989fe58897-li">
  <a href="/java/advanced/rocktmq/rocketmq%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedrocktmqrocketmqe6b688e681afe9989fe58897"><span class="">RocketMQ</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedaope58887e99da2-li">
  <a href="/java/advanced/aop%E5%88%87%E9%9D%A2/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedaope58887e99da2"><span class="">AOP面向切面编程</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedfastexcele68aa5e8a1a8e7bb84e4bbb6-li">
  <a href="/java/advanced/fastexcel%E6%8A%A5%E8%A1%A8%E7%BB%84%E4%BB%B6/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedfastexcele68aa5e8a1a8e7bb84e4bbb6"><span class="">FastExcel报表组件</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedgatewaye7bd91e585b3-li">
  <a href="/java/advanced/gateway%E7%BD%91%E5%85%B3/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedgatewaye7bd91e585b3"><span class="">Gateway网关</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedinterceptere68ba6e688aae599a8-li">
  <a href="/java/advanced/intercepter%E6%8B%A6%E6%88%AA%E5%99%A8/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedinterceptere68ba6e688aae599a8"><span class="">Intercepter拦截器</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedjwte4b88esession-li">
  <a href="/java/advanced/jwt%E4%B8%8Esession/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedjwte4b88esession"><span class="">JWT与Session</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancednacose9858de7bdaee4b8ade5bf83-li">
  <a href="/java/advanced/nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancednacose9858de7bdaee4b8ade5bf83"><span class="">Nacos配置中心</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedoauth2e8aea4e8af81-li">
  <a href="/java/advanced/oauth2%E8%AE%A4%E8%AF%81/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedoauth2e8aea4e8af81"><span class="">OAuth2认证</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedspringmvc-li">
  <a href="/java/advanced/springmvc/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedspringmvc"><span class="">SpringMVC</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedtransmittablethreadlocalttl-li">
  <a href="/java/advanced/transmittablethreadlocalttl/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedtransmittablethreadlocalttl"><span class="">TTL</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-javaadvancedwebsocket-li">
  <a href="/java/advanced/websocket/" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id="m-javaadvancedwebsocket"><span class="td-sidebar-nav-active-item">WebSocket</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancede4ba8be58aa1e7aea1e79086-li">
  <a href="/java/advanced/%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancede4ba8be58aa1e7aea1e79086"><span class="">事务管理</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancedreactore5938de5ba94e5bc8fe7bc96e7a88be5ba93-li">
  <a href="/java/advanced/reactor%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%BA%93/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancedreactore5938de5ba94e5bc8fe7bc96e7a88be5ba93"><span class="">响应式编程Reactor库</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-javaadvancede5a3b0e6988ee5bc8fe69c8de58aa1-li">
  <a href="/java/advanced/%E5%A3%B0%E6%98%8E%E5%BC%8F%E6%9C%8D%E5%8A%A1/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-javaadvancede5a3b0e6988ee5bc8fe69c8de58aa1"><span class="">声明式服务</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/hamhuo-hub/seaku/tree/main/C:%5cUsers%5cHuoZihang%5cDocuments%5cGitHub%5cseaku-src%5ccontent%5cen%5cjava%5cAdvanced%5cWebSocket.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/hamhuo-hub/seaku/edit/main/C:%5cUsers%5cHuoZihang%5cDocuments%5cGitHub%5cseaku-src%5ccontent%5cen%5cjava%5cAdvanced%5cWebSocket.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/hamhuo-hub/seaku/new/main/C:/Users/HuoZihang/Documents/GitHub/seaku-src/content/en/java/Advanced?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/hamhuo-hub/seaku/issues/new?title=WebSocket" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/hamhuo-hub/seaku/issues/new" class="td-page-meta--project td-page-meta__project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
  <a id="print" href="/java/advanced/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    
            <div class="taxonomy taxonomy-terms-cloud taxo-tags">
      <h5 class="taxonomy-title">Tag Cloud</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/gaming/" data-taxonomy-term="gaming"><span class="taxonomy-label">Gaming</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/gc/" data-taxonomy-term="gc"><span class="taxonomy-label">GC</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/internet/" data-taxonomy-term="internet"><span class="taxonomy-label">Internet</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/javaweb/" data-taxonomy-term="javaweb"><span class="taxonomy-label">JavaWeb</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" data-taxonomy-term="java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="taxonomy-label">Java数据类型</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/jvm/" data-taxonomy-term="jvm"><span class="taxonomy-label">JVM</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/list/" data-taxonomy-term="list"><span class="taxonomy-label">List</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/liveness/" data-taxonomy-term="liveness"><span class="taxonomy-label">Liveness</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/machinelearning/" data-taxonomy-term="machinelearning"><span class="taxonomy-label">MachineLearning</span><span class="taxonomy-count">5</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/mysql/" data-taxonomy-term="mysql"><span class="taxonomy-label">MySQL</span><span class="taxonomy-count">12</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/spring/" data-taxonomy-term="spring"><span class="taxonomy-label">Spring</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/synchronized/" data-taxonomy-term="synchronized"><span class="taxonomy-label">Synchronized</span><span class="taxonomy-count">4</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/threadobjects/" data-taxonomy-term="threadobjects"><span class="taxonomy-label">ThreadObjects</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" data-taxonomy-term="%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="taxonomy-label">中间件</span><span class="taxonomy-count">4</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" data-taxonomy-term="%E5%88%86%E5%B8%83%E5%BC%8F"><span class="taxonomy-label">分布式</span><span class="taxonomy-count">5</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E5%88%86%E6%B2%BB/" data-taxonomy-term="%E5%88%86%E6%B2%BB"><span class="taxonomy-label">分治</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B/" data-taxonomy-term="%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B"><span class="taxonomy-label">切面编程</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E5%8F%8C%E6%8C%87%E9%92%88/" data-taxonomy-term="%E5%8F%8C%E6%8C%87%E9%92%88"><span class="taxonomy-label">双指针</span><span class="taxonomy-count">4</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" data-taxonomy-term="%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="taxonomy-label">字符串</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" data-taxonomy-term="%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="taxonomy-label">并发编程</span><span class="taxonomy-count">22</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" data-taxonomy-term="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="taxonomy-label">操作系统</span><span class="taxonomy-count">7</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E6%95%B0%E7%BB%84/" data-taxonomy-term="%E6%95%B0%E7%BB%84"><span class="taxonomy-label">数组</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E6%97%A5%E5%BF%97/" data-taxonomy-term="%E6%97%A5%E5%BF%97"><span class="taxonomy-label">日志</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E6%A0%91/" data-taxonomy-term="%E6%A0%91"><span class="taxonomy-label">树</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/" data-taxonomy-term="%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="taxonomy-label">滑动窗口</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E7%9F%A9%E9%98%B5/" data-taxonomy-term="%E7%9F%A9%E9%98%B5"><span class="taxonomy-label">矩阵</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E7%AC%94%E8%AF%95/" data-taxonomy-term="%E7%AC%94%E8%AF%95"><span class="taxonomy-label">笔试</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-taxonomy-term="%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="taxonomy-label">设计模式</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E8%B4%AA%E5%BF%83/" data-taxonomy-term="%E8%B4%AA%E5%BF%83"><span class="taxonomy-label">贪心</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E9%80%92%E5%BD%92/" data-taxonomy-term="%E9%80%92%E5%BD%92"><span class="taxonomy-label">递归</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E9%80%9A%E9%85%8D%E7%AC%A6/" data-taxonomy-term="%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="taxonomy-label">通配符</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E9%89%B4%E6%9D%83%E6%A8%A1%E5%9E%8B/" data-taxonomy-term="%E9%89%B4%E6%9D%83%E6%A8%A1%E5%9E%8B"><span class="taxonomy-label">鉴权模型</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E9%93%BE%E8%A1%A8/" data-taxonomy-term="%E9%93%BE%E8%A1%A8"><span class="taxonomy-label">链表</span><span class="taxonomy-count">10</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/%E9%9D%A2%E8%AF%95/" data-taxonomy-term="%E9%9D%A2%E8%AF%95"><span class="taxonomy-label">面试</span><span class="taxonomy-count">1</span></a></li>
        </ul>
    </div>
  <div class="taxonomy taxonomy-terms-cloud taxo-categories">
      <h5 class="taxonomy-title">Categories</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/ai/" data-taxonomy-term="ai"><span class="taxonomy-label">AI</span><span class="taxonomy-count">5</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/java%E5%9F%BA%E7%A1%80%E8%83%BD%E5%8A%9B/" data-taxonomy-term="java%E5%9F%BA%E7%A1%80%E8%83%BD%E5%8A%9B"><span class="taxonomy-label">Java基础能力</span><span class="taxonomy-count">44</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/java%E8%BF%9B%E9%98%B6%E8%83%BD%E5%8A%9B/" data-taxonomy-term="java%E8%BF%9B%E9%98%B6%E8%83%BD%E5%8A%9B"><span class="taxonomy-label">Java进阶能力</span><span class="taxonomy-count">13</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/school/" data-taxonomy-term="school"><span class="taxonomy-label">School</span><span class="taxonomy-count">6</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/%E6%97%A5%E5%BF%97/" data-taxonomy-term="%E6%97%A5%E5%BF%97"><span class="taxonomy-label">日志</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/%E7%AE%97%E6%B3%95/" data-taxonomy-term="%E7%AE%97%E6%B3%95"><span class="taxonomy-label">算法</span><span class="taxonomy-count">25</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/%E8%AF%BE%E7%A8%8B%E5%BD%92%E6%A1%A3/" data-taxonomy-term="%E8%AF%BE%E7%A8%8B%E5%BD%92%E6%A1%A3"><span class="taxonomy-label">课程归档</span><span class="taxonomy-count">6</span></a></li>
        <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/%E9%9D%A2%E8%AF%95/" data-taxonomy-term="%E9%9D%A2%E8%AF%95"><span class="taxonomy-label">面试</span><span class="taxonomy-count">4</span></a></li>
        </ul>
    </div>
  
	
          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/java/">Doc</a></li>
  <li class="breadcrumb-item">
    <a href="/java/advanced/">Java进阶能力</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    WebSocket</li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>WebSocket</h1>
	<div class="lead">HTTP只能单向向服务器请求, 如果要实现服务器通知, 就必须由客户端轮询, 压力非常大. 并且HTTP会携带无效信息, 延迟很高
因此出现了WebSocket</div>
	<header class="article-meta">
		<div class="taxonomy taxonomy-terms-article taxo-tags">
  <h5 class="taxonomy-title">Tags:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="https://hamhuo.xyz/tags/javaweb/" data-taxonomy-term="javaweb"><span class="taxonomy-label">JavaWeb</span></a></li>
    </ul>
</div>
<div class="taxonomy taxonomy-terms-article taxo-categories">
  <h5 class="taxonomy-title">Categories:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="https://hamhuo.xyz/categories/java%E8%BF%9B%E9%98%B6%E8%83%BD%E5%8A%9B/" data-taxonomy-term="java%E8%BF%9B%E9%98%B6%E8%83%BD%E5%8A%9B"><span class="taxonomy-label">Java进阶能力</span></a></li>
    </ul>
</div>

  </header>
	<p>如果需要定期给浏览器推送数据，例如股票行情，或者不定期给浏览器推送数据，例如在线聊天，基于HTTP协议实现这类需求，只能依靠浏览器的JavaScript定时轮询，效率很低且实时性不高。</p>
<p>2009年出现的新技术<code>Websocket</code> 允许建立浏览器客户端和服务端之间的双向连接, 并且发送轻量级的数据模型, 服务端可以在需要时直接向客户端推送消息</p>
<p>不同于传统的<code>Http</code> ,<code>Websocket</code>  允许建立通路, 可以直接发送信息而不需像HTTP一样创建连接上下文, 原理如下</p>
<p>在建立TCP连接后, 附带几个请求头</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#8caaee">GET</span> <span style="color:#ef9f76">/chat</span> <span style="color:#ca9ee6">HTTP</span><span style="color:#99d1db;font-weight:bold">/</span><span style="color:#ef9f76">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#99d1db;font-weight:bold">:</span> www.example.com
</span></span><span style="display:flex;"><span>Upgrade<span style="color:#99d1db;font-weight:bold">:</span> websocket
</span></span><span style="display:flex;"><span>Connection<span style="color:#99d1db;font-weight:bold">:</span> Upgrade
</span></span></code></pre></div><p>此后连接升级为长连接</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>HTTP/1.1 101 Switching Protocols
</span></span><span style="display:flex;"><span>Upgrade: websocket
</span></span><span style="display:flex;"><span>Connection: Upgrade
</span></span></code></pre></div><p>收到成功响应后表示WebSocket“握手”成功，这样，代表WebSocket的这个TCP连接将不会被服务器关闭，而是一直保持，服务器可随时向浏览器推送消息，浏览器也可随时向服务器推送消息。双方推送的消息既可以是文本消息，也可以是二进制消息，一般来说，绝大部分应用程序会推送基于JSON的文本消息。</p>
<h4 id="使用-websocket">使用 Websocket<a class="td-heading-self-link" href="#%e4%bd%bf%e7%94%a8-websocket" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>开始前阅读 <a href="content/en/java/Advanced/_index.md">架构说明</a></p>
<p>建立新模块 <code>sample-ws</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">&lt;!-- ws --&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;artifactId&gt;</span>spring-boot-starter-websocket<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>启动类</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * 描述：程序启动入口  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> *  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @version 1.0.0  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span><span style="color:#8caaee;font-weight:bold">@SpringBootApplication</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableBinding</span>(Sink.<span style="color:#8caaee">class</span>)  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableDiscoveryClient</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">WsApplication</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) {  
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#8caaee">run</span>(WsApplication.<span style="color:#8caaee">class</span>, args);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>实现服务端和浏览器的双向通信, 我们要写一个服务器</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Component</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@ServerEndpoint</span>(<span style="color:#a6d189">&#34;/chat&#34;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">ChatServer</span> {
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * 保存连接对象, 连接池, 放用户session和key
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> ConcurrentHashMap<span style="color:#99d1db;font-weight:bold">&lt;</span>String, Session<span style="color:#99d1db;font-weight:bold">&gt;</span> SESSION_POOL <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> ConcurrentHashMap<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnOpen</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onOpen</span>(Session session) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnMessage</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> String <span style="color:#8caaee">onMessage</span>(String text, Session session) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnClose</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onClose</span>(Session session)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnError</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onError</span>(Session session, Throwable throwable)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>解释一下</p>
<ol>
<li>
<p>首先组件注解加上, Spring 会自动装载为组件</p>
</li>
<li>
<p>关于 <code>@ServerEndpoint</code>
WebSocket 是一种基于 TCP 的协议，它是持久化连接，通信过程中不会像 HTTP 请求那样每次都经过请求-响应的流程，因此不能直接通过传统的 Spring MVC 控制器方法来处理。</p>
<p><code>@ServerEndpoint</code> 是 WebSocket 规范中的一种标注方式，用来标识一个 WebSocket 服务器端点。当客户端连接到这个端点时，会自动调用这个类中的相应方法。</p>
<p>我们只需要知道服务器与 /server 绑定即可</p>
</li>
<li>
<p>我们在server中定义了四个方法, 启动时调用, 消息时调用, 关闭时调用, 错误时调用</p>
</li>
<li>
<p>我们创建一个链接池, 存放浏览器和服务器的长连接</p>
</li>
</ol>
<p>这个端点注解依赖一个配置类</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250223215044977.png" alt="image.png"></p>
<p>我们在 <code>ws.config</code> 下新建一个配置类 ,这是写死的, 不用理解</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @program: demo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @description: 服务端点配置  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author: hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> **/</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Configuration</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableWebSocket</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">WebSocketConfig</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Bean</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> ServerEndpointExporter <span style="color:#8caaee">serverEndpoint</span>() {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> <span style="color:#ca9ee6">new</span> ServerEndpointExporter();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>当浏览器首先试图建立与服务器的连接, 这里调用 <code>@OnOpen</code> 注解方法</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnOpen</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onOpen</span>(Session session) <span style="color:#e78284">throws</span> IOException {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//判断客户端对象是否存在  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//排除重复的连接对象  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (SESSION_POOL.<span style="color:#8caaee">containsKey</span>(session.<span style="color:#8caaee">getQueryString</span>())) {  
</span></span><span style="display:flex;"><span>        CloseReason reason <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> CloseReason(CloseReason.<span style="color:#8caaee">CloseCodes</span>.<span style="color:#8caaee">CANNOT_ACCEPT</span>, <span style="color:#a6d189">&#34;ID冲突，连接拒绝&#34;</span>);  
</span></span><span style="display:flex;"><span>        session.<span style="color:#8caaee">getUserProperties</span>().<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;reason&#34;</span>, reason);  
</span></span><span style="display:flex;"><span>        session.<span style="color:#8caaee">close</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//将客户端记录到Map中  </span>
</span></span><span style="display:flex;"><span>    SESSION_POOL.<span style="color:#8caaee">put</span>(session.<span style="color:#8caaee">getQueryString</span>(), session);  
</span></span><span style="display:flex;"><span>    System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;客户端（&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;）：开启连接&#34;</span>);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>解释一下, 浏览器会传入一个客户端ID, 服务器根据ID来提供服务</p>
<p>每个ID标识了长连接, 服务器根据ID提供服务</p>
<ol>
<li>传入连接后判断是否重复, 从连接池拿session里的key, 如果重复就拒绝连接</li>
<li>没有重复, 将Session保存到连接池(Map)里</li>
<li>控制套打印日志, 这里可以用slf4j</li>
</ol>
<blockquote>
<p>注意:
这里的<code>Session</code> 指的是长连接, 和 <code>HTTP Session</code> 不是一个东西</p></blockquote>
<p>之后长连接建立, 可以双向监听信息, 一旦服务器或者浏览器有信息了就调用 <code>@OnMessage</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnMessage</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> String <span style="color:#8caaee">onMessage</span>(String text, Session session) <span style="color:#e78284">throws</span> IOException {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//解析消息 =&gt; ID::消息内容  </span>
</span></span><span style="display:flex;"><span>    String<span style="color:#99d1db;font-weight:bold">[]</span> msgArr <span style="color:#99d1db;font-weight:bold">=</span> text.<span style="color:#8caaee">split</span>(<span style="color:#a6d189">&#34;::&#34;</span>, 2);  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//群发消息 ID=all表示群发  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (<span style="color:#a6d189">&#34;all&#34;</span>.<span style="color:#8caaee">equalsIgnoreCase</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>0<span style="color:#99d1db;font-weight:bold">]</span>)) {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">for</span> (Session one : SESSION_POOL.<span style="color:#8caaee">values</span>()) {  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//排除自己  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">if</span> (session <span style="color:#99d1db;font-weight:bold">==</span> one) {  
</span></span><span style="display:flex;"><span>                <span style="color:#ca9ee6">continue</span>;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//发送消息  </span>
</span></span><span style="display:flex;"><span>            one.<span style="color:#8caaee">getBasicRemote</span>().<span style="color:#8caaee">sendText</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">]</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//指定发送人, 不是all的情况  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">else</span> {  
</span></span><span style="display:flex;"><span>        Session target <span style="color:#99d1db;font-weight:bold">=</span> SESSION_POOL.<span style="color:#8caaee">get</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>0<span style="color:#99d1db;font-weight:bold">]</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (target <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>            target.<span style="color:#8caaee">getBasicRemote</span>().<span style="color:#8caaee">sendText</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">]</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;:消息发送成功&#34;</span>;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>消息发送的方式有两种, 点对点和群发</p>
<p>点对点就找出目标Session, 服务器向Session写信息发送就行
群发就需要遍历连接池的每一个Session, 全部写信息</p>
<p>当然, 前提是排除发送者的Session</p>
<p>关闭连接, 也就是浏览器离线需要执行线程池移除线程的操作, 调用 <code>@OnClose</code> 方法
这里注意, webSocket并没有强制关闭连接的能力, 这是通知远程连接自主关闭, 服务器只负责监视是否关闭</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnClose</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onClose</span>(Session session) {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//处理拒绝连接session关闭对象, 不从池子里移除  </span>
</span></span><span style="display:flex;"><span>    Object obj <span style="color:#99d1db;font-weight:bold">=</span> session.<span style="color:#8caaee">getUserProperties</span>().<span style="color:#8caaee">get</span>(<span style="color:#a6d189">&#34;reason&#34;</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (obj <span style="color:#ca9ee6">instanceof</span> CloseReason) {  
</span></span><span style="display:flex;"><span>        CloseReason reason <span style="color:#99d1db;font-weight:bold">=</span> (CloseReason) obj;  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (reason.<span style="color:#8caaee">getCloseCode</span>() <span style="color:#99d1db;font-weight:bold">==</span> CloseReason.<span style="color:#8caaee">CloseCodes</span>.<span style="color:#8caaee">CANNOT_ACCEPT</span>) {  
</span></span><span style="display:flex;"><span>            System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;拒绝客户端（&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;）：关闭连接&#34;</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">return</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//将session对象从map中移除,正常关闭  </span>
</span></span><span style="display:flex;"><span>    SESSION_POOL.<span style="color:#8caaee">remove</span>(session.<span style="color:#8caaee">getQueryString</span>());  
</span></span><span style="display:flex;"><span>    System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;客户端（&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;）：关闭连接&#34;</span>);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>这是比较简单的应用不再考虑连接复用的问题</p></blockquote>
<p>接下来写浏览器页面</p>
<p>这里我们略过了~</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">&lt;!DOCTYPE html&gt;</span>  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">html</span> <span style="color:#8caaee">lang</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;en&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">head</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">meta</span> <span style="color:#8caaee">charset</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;UTF-8&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">title</span>&gt;聊天室客户端&lt;/<span style="color:#ca9ee6">title</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">head</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">body</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">h1</span>&gt;Chat Client&lt;/<span style="color:#ca9ee6">h1</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">div</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;clientId&#34;</span> <span style="color:#8caaee">placeholder</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;输入ID&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;1&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">onclick</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;init()&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;连接服务器&#34;</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;button&#34;</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;receiverId&#34;</span> <span style="color:#8caaee">placeholder</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;输入接收人ID&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;all&#34;</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">textarea</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;message&#34;</span> <span style="color:#8caaee">style</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;margin: 0; height: 197px; width: 362px;&#34;</span>  
</span></span><span style="display:flex;"><span>              <span style="color:#8caaee">placeholder</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;发送消息内容&#34;</span>&gt;&lt;/<span style="color:#ca9ee6">textarea</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">onclick</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;send()&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;发送消息&#34;</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;button&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">onclick</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;closeConnect()&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;关闭连接&#34;</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;button&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">div</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">div</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;output&#34;</span>&gt;&lt;/<span style="color:#ca9ee6">div</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">script</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;text/javascript&#34;</span> <span style="color:#8caaee">language</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;JavaScript&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//屏幕回显输出方法  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">function</span> writeToScreen(message) {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> pre <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.createElement(<span style="color:#a6d189">&#34;p&#34;</span>);  
</span></span><span style="display:flex;"><span>        pre.style.wordWrap <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;break-word&#34;</span>;  
</span></span><span style="display:flex;"><span>        pre.innerHTML <span style="color:#99d1db;font-weight:bold">=</span> message;  
</span></span><span style="display:flex;"><span>        <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;output&#34;</span>).appendChild(pre);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//初始化websocket  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">let</span> echo_websocket;  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">function</span> init() {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> clientId <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;clientId&#34;</span>).value;  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">/* 这里端口是写死的 */</span>        <span style="color:#e78284">let</span> wsUri <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;ws://localhost:10800/chat?&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> clientId;  
</span></span><span style="display:flex;"><span>        writeToScreen(<span style="color:#a6d189">&#34;连接到&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> wsUri);  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//1.创建WebSocket客户端对象  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> WebSocket(wsUri);  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//2.开门握手完成回调  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onopen <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span> (evt) {  
</span></span><span style="display:flex;"><span>            console.log(evt);  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#34;连接打开成功 !&#34;</span>);  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//3.监听服务端的消息  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onmessage <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span> (evt) {  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#34;接收服务端消息:&lt;br&gt; &#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> evt.data);  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//4.如果连接中断  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onerror <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span> (evt) {  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#39;&lt;span style=&#34;color: red;&#34;&gt;ERROR:&#39;</span><span style="color:#99d1db;font-weight:bold">+</span>evt.data<span style="color:#99d1db;font-weight:bold">+</span><span style="color:#a6d189">&#39;&lt;/span&gt;&#39;</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>            closeConnect();  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//5.注册close事件  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onclose <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span>(evt){  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#39;&lt;span style=&#34;color: green;&#34;&gt;INFO：关闭连接&lt;/span&gt; &#39;</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">if</span>(evt.reason){  
</span></span><span style="display:flex;"><span>                writeToScreen  
</span></span><span style="display:flex;"><span>                (<span style="color:#a6d189">`&lt;span style=&#34;color: red;&#34;&gt;错误信息：</span><span style="color:#a6d189">${</span>evt.reason<span style="color:#a6d189">}</span><span style="color:#a6d189">&lt;/span&gt; `</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//6.向服务发送消息  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">function</span> send() {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> message <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;message&#34;</span>).value;  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> receiver <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;receiverId&#34;</span>).value;  
</span></span><span style="display:flex;"><span>        echo_websocket.send(receiver <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;::&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> message);  
</span></span><span style="display:flex;"><span>        writeToScreen(<span style="color:#a6d189">&#34;发送消息: &#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> message);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//7.如果不需要通讯，那么关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">function</span> closeConnect() {  
</span></span><span style="display:flex;"><span>        echo_websocket.close();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">script</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">body</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">html</span>&gt;
</span></span></code></pre></div><p>我们需要解释下构建/发送信息的代码</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>//6.向服务发送消息  
</span></span><span style="display:flex;"><span>    function send() {  
</span></span><span style="display:flex;"><span>        let message = document.getElementById(&#34;message&#34;).value;  
</span></span><span style="display:flex;"><span>        let receiver = document.getElementById(&#34;receiverId&#34;).value;  
</span></span><span style="display:flex;"><span>        echo_websocket.send(receiver + &#34;::&#34; + message);  
</span></span><span style="display:flex;"><span>        writeToScreen(&#34;发送消息: &#34; + message);  
</span></span><span style="display:flex;"><span>    } 
</span></span></code></pre></div><p>这里拿到表单组件, 取值后通过 <code>::</code> 拼接为消息, 链接符之前为id, 之后为消息</p>
<p>其中初始化的 <code>echo_websocket</code> 组件是dom库提供的 <code>echo_websocket = new WebSocket(wsUri);</code> , 除了IE其他浏览器都支持</p>
<p>在前端打开三个浏览器页面, 作为三个客户端</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250223215339746.png" alt="image.png"></p>
<p>注意id要不同</p>
<p>后台运行服务器, 就可以开始监听了</p>

	<div class="td-page-meta__lastmod">
  Last modified March 3, 2025: <a href="https://github.com/hamhuo-hub/seaku/commit/41127dd0a59194208e0e3ecb279d9d2e47e0c166">组件笔记 3/3 (41127dd)</a>
</div>

</div>


          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://example.org/twitter" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Stack Overflow" aria-label="Stack Overflow">
    <a target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/hamhuo-hub/seaku" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Developer mailing list" aria-label="Developer mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025&ndash;2025
    <span class="td-footer__authors">海阔知识库 | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.90902a026ed2aee7ed45d85797f4c790b240ba148ac6f8a6f194cb1981ffecf5.js" integrity="sha256-kJAqAm7SruftRdhXl/THkLJAuhSKxvim8ZTLGYH/7PU=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>