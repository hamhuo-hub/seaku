<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://hamhuo.xyz/java/advanced/">
<link rel="alternate" type="application/rss&#43;xml" href="https://hamhuo.xyz/java/advanced/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Java进阶能力 | 海阔集</title>
<meta name="description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis WebSocket FastExcel报表 Gateway网关(SpringCloudGateway) 中间件 消息队列 Nacos配置中心 Sential声明式服务 需要相关模块依赖, 如下是模块的实例
wms-sample-mq 模块 pom.xml
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-java&lt;/artifactId&gt; &lt;version&gt;${revision}&lt;/version&gt; &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt; &lt;/parent&gt; &lt;artifactId&gt;wms-sample&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- spring mvc --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- common --&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo&lt;/groupId&gt; &lt;artifactId&gt;wms-common&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-domain&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos config --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 启动类">
<meta property="og:url" content="https://hamhuo.xyz/java/advanced/">
  <meta property="og:site_name" content="海阔集">
  <meta property="og:title" content="Java进阶能力">
  <meta property="og:description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis WebSocket FastExcel报表 Gateway网关(SpringCloudGateway) 中间件 消息队列 Nacos配置中心 Sential声明式服务 需要相关模块依赖, 如下是模块的实例
wms-sample-mq 模块 pom.xml
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-java&lt;/artifactId&gt; &lt;version&gt;${revision}&lt;/version&gt; &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt; &lt;/parent&gt; &lt;artifactId&gt;wms-sample&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- spring mvc --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- common --&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo&lt;/groupId&gt; &lt;artifactId&gt;wms-common&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-domain&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos config --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 启动类">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Java进阶能力">
  <meta itemprop="description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis WebSocket FastExcel报表 Gateway网关(SpringCloudGateway) 中间件 消息队列 Nacos配置中心 Sential声明式服务 需要相关模块依赖, 如下是模块的实例
wms-sample-mq 模块 pom.xml
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-java&lt;/artifactId&gt; &lt;version&gt;${revision}&lt;/version&gt; &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt; &lt;/parent&gt; &lt;artifactId&gt;wms-sample&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- spring mvc --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- common --&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo&lt;/groupId&gt; &lt;artifactId&gt;wms-common&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-domain&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos config --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 启动类">
  <meta itemprop="dateModified" content="2025-03-03T04:12:40+08:00">
  <meta itemprop="wordCount" content="108">
  <meta itemprop="keywords" content="Java进阶能力">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Java进阶能力">
  <meta name="twitter:description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis WebSocket FastExcel报表 Gateway网关(SpringCloudGateway) 中间件 消息队列 Nacos配置中心 Sential声明式服务 需要相关模块依赖, 如下是模块的实例
wms-sample-mq 模块 pom.xml
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-java&lt;/artifactId&gt; &lt;version&gt;${revision}&lt;/version&gt; &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt; &lt;/parent&gt; &lt;artifactId&gt;wms-sample&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- spring mvc --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- common --&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo&lt;/groupId&gt; &lt;artifactId&gt;wms-common&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.hamhuo.star&lt;/groupId&gt; &lt;artifactId&gt;wms-domain&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- alibaba nacos config --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 启动类">
<link rel="preload" href="/scss/main.min.023240d665d6ea36df214aa4d82691f4a70d71a02d1740f34f44227813c4b7d9.css" as="style" integrity="sha256-AjJA1mXW6jbfIUqk2CaR9KcNcaAtF0DzT0QieBPEt9k=" crossorigin="anonymous">
<link href="/scss/main.min.023240d665d6ea36df214aa4d82691f4a70d71a02d1740f34f44227813c4b7d9.css" rel="stylesheet" integrity="sha256-AjJA1mXW6jbfIUqk2CaR9KcNcaAtF0DzT0QieBPEt9k=" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="800" height="800" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23.3 8.40007 21.82 6.40008C21.7248 6.27314 21.6008 6.17066 21.4583 6.10111 21.3157 6.03156 21.1586 5.99693 21 6.00008H11.2C11.0555 6.00007 10.9128 6.03135 10.7816 6.09177 10.6504 6.15219 10.5339 6.24031 10.44 6.35007L8.71998 8.35008C8.57227 8.53401 8.49435 8.76424 8.49998 9.00008V16.2901C8.50262 18.0317 9.19567 19.7013 10.4272 20.9328c1.2316 1.2316 2.9011 1.9246 4.6428 1.9273h1.86C18.6716 22.8574 20.3412 22.1644 21.5728 20.9328c1.2315-1.2315 1.9245-2.9011 1.9272-4.6427V9.00008C23.5 8.7837 23.4298 8.57317 23.3 8.40007z" fill="#ffcc80"/><path d="M29.78 28.38l-4-5C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38z" fill="#01579b"/><path d="M29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344L15.73 11.6C15.906 11.6534 16.094 11.6534 16.27 11.6l13-3.59997C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003z" fill="#01579b"/><path d="M11.22 6C11.0756 5.99999 10.9328 6.03127 10.8016 6.09169 10.6704 6.15211 10.5539 6.24023 10.46 6.35l-1.72 2C8.58509 8.53114 8.49998 8.76166 8.5 9v7.29C8.50264 18.0317 9.19569 19.7012 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272H16V6H11.22z" fill="#ffe0b2"/><path d="M7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H16V25L7.21999 23z" fill="#0277bd"/><path d="M15.71 2.00002l-13 4C2.49742 6.06422 2.31226 6.19734 2.1837 6.3784c-.12855.18107-.19318.39977-.1837.62162C1.9917 7.22447 2.0592 7.44518 2.19163 7.62658 2.32405 7.80799 2.5137 7.93954 2.73 8.00002L15.73 11.6C15.8194 11.6146 15.9106 11.6146 16 11.6V2.00002C15.9039 1.98469 15.8061 1.98469 15.71 2.00002z" fill="#0277bd"/><path d="M2.73 8.00003l5.77 1.56V16.29C8.50264 18.0317 9.19569 19.7013 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272h1.86C18.6717 22.8574 20.3412 22.1643 21.5728 20.9328c1.2315-1.2315 1.9246-2.9011 1.9272-4.6428V9.56003l5.77-1.56C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344zM21.5 16.29C21.4974 17.5013 21.015 18.6621 20.1586 19.5186 19.3021 20.3751 18.1412 20.8574 16.93 20.86H15.07C13.8588 20.8574 12.6979 20.3751 11.8414 19.5186 10.985 18.6621 10.5026 17.5013 10.5 16.29V10.11l5.23 1.45C15.906 11.6134 16.094 11.6134 16.27 11.56l5.23-1.45v6.18zM16 4.05003l9.44 2.95-9.44 2.56-9.44-2.56 9.44-2.95z" fill="#263238"/><path d="M25.78 23.38C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38l-4-5zM5.07999 28l2.31-2.89L15.78 27C15.9251 27.0299 16.0748 27.0299 16.22 27l8.39-1.87L26.92 28H5.07999z" fill="#263238"/></svg></span><span class="navbar-brand__name">海阔集</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/leetcode/"><span>Alog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/java/"><span>Doc</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/graphicsai/"><span>Graphics and AI</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/interview/"><span>Interview</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/graphicsai/torch/"><span>Pytorch basics tutorials</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/school/"><span>课程归档</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.8c38df4b89312cec903a6ee2b331cb5f.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/java/advanced/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Java进阶能力</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-aca1efb0a9ee065c0b3ad65d73e67dbe"></a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-c5546365fa7a60719df25e8956893000">FastDFS分布式存储</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-5480c4968cf2bd7572c3d657358f7947"></a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-62bb39299d50fdae18e411e45b33da59">RocketMQ</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-6847462fbc45c0ec0e2539734fdfc520">AOP面向切面编程</a></li>


    
  
    
    
	
<li>4: <a href="#pg-5ba10e92aedbfc888e0e1fc25ad92362">FastExcel报表组件</a></li>


    
  
    
    
	
<li>5: <a href="#pg-2b22ec5ab6cb18f57e4a05415d0a34e2">Gateway网关</a></li>


    
  
    
    
	
<li>6: <a href="#pg-a10ef0a98cd31d88eed3637bec2fff46">Intercepter拦截器</a></li>


    
  
    
    
	
<li>7: <a href="#pg-ed66f29438332c88139caba654f9e301">JWT与Session</a></li>


    
  
    
    
	
<li>8: <a href="#pg-14466de61718f3e7e4e0634fcd427c5f">Nacos配置中心</a></li>


    
  
    
    
	
<li>9: <a href="#pg-bfce5c28aec1143b74ff0aa46a5285a4">OAuth2认证</a></li>


    
  
    
    
	
<li>10: <a href="#pg-7784bca3c26210aa2f38f471a8a3c1c4">SpringMVC</a></li>


    
  
    
    
	
<li>11: <a href="#pg-c5be60b3ee2566487eb164b032000197">TTL</a></li>


    
  
    
    
	
<li>12: <a href="#pg-f91a61b39377d9ea9caf33190d589187">WebSocket</a></li>


    
  
    
    
	
<li>13: <a href="#pg-7a2c40656558a17fe41d7952d03dfa64">事务管理</a></li>


    
  
    
    
	
<li>14: <a href="#pg-ca8521f6a11893682100c677a8e28283">响应式编程Reactor库</a></li>


    
  
    
    
	
<li>15: <a href="#pg-7f81b67460689b745ab9bb3e9564c653">声明式服务</a></li>


    
  

    </ul>


<div class="content">
      <p>内容来源:</p>
<ul>
<li>沉默王二 GitHub 上开源的知识库《<a href="https://github.com/itwanger/toBeBetterJavaer">Java 进阶之路</a>》</li>
<li><a href="https://www.rabbitmq.com/tutorials">rabbitMQ</a></li>
<li><a href="https://javaguide.cn/">JavaGuide</a></li>
<li><a href="https://www.zhihu.com/question/19730582/answer/1663627873">知乎-阿里大淘宝</a></li>
</ul>
<p>Java进阶能力
Java作为一门编程语言, 需要和其他组件一起完成某个项目
一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码</p>
<ul>
<li>Redis</li>
<li>WebSocket</li>
<li>FastExcel报表</li>
<li>Gateway网关(SpringCloudGateway)</li>
<li>中间件
<ul>
<li>消息队列</li>
<li>Nacos配置中心</li>
<li>Sential声明式服务</li>
</ul>
</li>
</ul>
<p>需要相关模块依赖, 如下是模块的实例</p>
<p><code>wms-sample-mq</code> 模块
<code>pom.xml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;project</span> <span style="color:#8caaee">xmlns=</span><span style="color:#a6d189">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style="color:#8caaee">xmlns:xsi=</span><span style="color:#a6d189">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee">xsi:schemaLocation=</span><span style="color:#a6d189">&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#ca9ee6">&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;modelVersion&gt;</span>4.0.0<span style="color:#ca9ee6">&lt;/modelVersion&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;parent&gt;</span>        <span style="color:#ca9ee6">&lt;groupId&gt;</span>com.hamhuo.star<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;artifactId&gt;</span>wms-java<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;version&gt;</span>${revision}<span style="color:#ca9ee6">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;relativePath&gt;</span>../pom.xml<span style="color:#ca9ee6">&lt;/relativePath&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;/parent&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;artifactId&gt;</span>wms-sample<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;dependencies&gt;</span>        <span style="color:#737994;font-style:italic">&lt;!-- spring mvc --&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">&lt;!-- common --&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;groupId&gt;</span>com.hamhuo<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;artifactId&gt;</span>wms-common<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;dependency&gt;</span>            <span style="color:#ca9ee6">&lt;groupId&gt;</span>com.hamhuo.star<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;artifactId&gt;</span>wms-domain<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">&lt;!-- alibaba nacos discovery --&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">&lt;!-- alibaba nacos config --&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">&lt;/dependency&gt;</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;/dependencies&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;/project&gt;</span>
</span></span></code></pre></div><p>启动类</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;p&gt; 描述：模块程序启动入口  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;/p&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@SpringBootApplication</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableDiscoveryClient</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableBinding</span>(Source.<span style="color:#8caaee">class</span>)  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">MqApplication</span> {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) {  
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#8caaee">run</span>(MqApplication.<span style="color:#8caaee">class</span>, args);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-aca1efb0a9ee065c0b3ad65d73e67dbe">1 - </h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c5546365fa7a60719df25e8956893000">1.1 - FastDFS分布式存储</h1>
    <div class="lead">分布式存储中间件</div>
	<h4 id="为什么需要文件服务器">为什么需要文件服务器?<a class="td-heading-self-link" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e6%96%87%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>浏览器请求可能会携带头像文件, 服务器处理后存储在本地磁盘</p>
<p>但是假如还有一个服务需要操作订单</p>
<p>那么就需要异步从存储头像拿头像</p>
<p>也就是说用户信息业务崩溃后, 导致订单服务器也一并崩溃</p>
<p>为了解耦合, 我们把文件存储到专门的服务器里, 保证系统稳定</p>
<p>当用户在订单管理修改信息后, 还需要同步到用户信息服务器</p>
<p>这需要传递两次, 还要保证一致性, 倒不如直接把服务器分离, 只传递文件地址
这样就可以减少服务间的传递, 而且也不需要传递大尺寸的文件, 只要传链接就可以</p>
<h4 id="使用">使用<a class="td-heading-self-link" href="#%e4%bd%bf%e7%94%a8" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>检查nacos配置
第三方服务</p>
<p>下载地址是由nginx管理的, 所以还需要nginx配置</p>
<p>注入fastdfs客户端
配置文件服务器url 也就是 nginx的IP地址</p>
<p>上传文件
传入 MultipatFile file
首先提取后缀名, 左闭右开去掉点放到新的子串
直接调客户端上传即可
用户回显, 是否上传成功, 看有没有文件信息就可以</p>
<p>下载
也就是响应文件, 创建响应实体内部放字节流
调客户端下载, 传入group组和文件id
下载完成的文件命名, 用时间就可以
定义好的名字回传道响应的响应头</p>
<p>删除文件
还是组和文件id
调客户端删除
回调是int值, 匹配定义的预设输出传回即可</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5480c4968cf2bd7572c3d657358f7947">2 - </h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-62bb39299d50fdae18e411e45b33da59">2.1 - RocketMQ</h1>
    <div class="lead">MQ的一种, 高并发常用</div>
	<blockquote>
<p>了解: <a href="WebSocket.md">WebSocket</a></p></blockquote>
<p>学习过 <code>websocekt</code> 后, 我们知道通过建立长连接可以实现 服务器和浏览器的双向推送
通过浏览器协调, 可以实现端对端的通信
<code>webServer</code> 初始化一个 Session 池作为核心容器, 当 <code>webServer</code> 在分布式中作为服务注入时, 其他服务也要调用消息怎么办?</p>
<p>可以让其他服务作为消费者, 让服务生产消息, 但是<code>webserver</code> 一旦负责消息通讯和消息生产职责就不再单一, 需要解耦</p>
<p>长连接传递的消息是即时的, 一旦连接断开消息就会丢失, 我们需要一个方法持久化消息</p>
<p>长连接会阻塞服务线程, 建立连接后双方不得不占用一个线程持续的监听, 需要把监听的任务解耦出去. 一旦并发消息过多, 服务器可能会崩溃</p>
<p>综上, 我们有了消息队列</p>
<ul>
<li>
<ol>
<li><strong>异步通信</strong></li>
</ol>
</li>
</ul>
<p><strong>场景描述</strong>：当系统中的应用程序需要异步通信时，可以使用消息中间件来实现。<br>
<strong>示例</strong>：在一个电商系统中，订单系统下单后需要给库存系统发送异步消息，以减少系统之间的耦合，避免同步调用导致的性能问题或响应延迟。</p>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>减少耦合</strong>：系统可以在不等待响应的情况下继续进行其他操作。</li>
<li><strong>提高系统性能</strong>：减少了同步阻塞，提高了响应速度。</li>
</ul>
<hr>
<ol start="2">
<li><strong>应用解耦</strong></li>
</ol>
<p><strong>场景描述</strong>：当应用程序需要进行松耦合的通信时，可以使用消息中间件来实现。<br>
<strong>示例</strong>：在微服务架构中，不同服务之间可以通过消息中间件进行通信，避免直接调用服务导致的依赖关系过强。</p>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>降低耦合度</strong>：服务之间通过消息中间件进行通信，不需要直接调用，提高系统的灵活性。</li>
<li><strong>增强可维护性</strong>：服务之间的更新和维护不影响其他服务。</li>
</ul>
<hr>
<ol start="3">
<li><strong>消息排队</strong></li>
</ol>
<p><strong>场景描述</strong>：当系统中需要处理大量的消息时，可以使用消息中间件来实现消息排队，确保消息的顺序和可靠性。<br>
<strong>示例</strong>：在金融行业中，需要处理大量的交易消息，消息中间件可以实现消息排队，确保每笔交易都得到正确处理。</p>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>保证消息顺序</strong>：确保按顺序处理每条消息。</li>
<li><strong>消息可靠性</strong>：即使出现系统故障，未处理的消息仍然可以从队列中恢复。</li>
</ul>
<hr>
<ol start="4">
<li><strong>负载均衡</strong></li>
</ol>
<p><strong>场景描述</strong>：当系统需要处理大量的请求时，可以使用消息中间件来实现负载均衡。<br>
<strong>示例</strong>：在电商系统中，订单系统下单请求可以通过消息中间件发送到多个库存系统中，从而实现负载均衡。</p>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>分担负载</strong>：通过将消息分发到多个消费者，实现负载均衡，避免单点压力。</li>
<li><strong>提高系统吞吐量</strong>：通过多节点并发处理提高系统处理能力。</li>
</ul>
<hr>
<ol start="5">
<li><strong>系统削峰填谷</strong></li>
</ol>
<p><strong>场景描述</strong>：当系统中出现高峰期时，可以使用消息中间件来平滑处理请求。<br>
<strong>示例</strong>：在电商系统中，双十一等促销活动可能会导致系统请求量急剧增加，消息中间件可以通过缓存请求，避免系统崩溃。</p>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>平滑流量</strong>：在高峰期通过消息队列缓存请求，避免系统过载。</li>
<li><strong>提高系统稳定性</strong>：避免高并发请求导致的性能瓶颈或服务崩溃。</li>
</ul>
<h4 id="使用-rocketmq">使用 <code>RocketMQ</code><a class="td-heading-self-link" href="#%e4%bd%bf%e7%94%a8-rocketmq" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>并发环境下的消息队列用阿里提供的 <code>RocketMQ</code> 合适</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">server</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">port</span>: ${sp.publish}  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">spring</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">application</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">name</span>: ${sn.publish}  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">cloud</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">stream</span>:  
</span></span><span style="display:flex;"><span>      <span style="color:#ca9ee6">rocketmq</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">binder</span>:  
</span></span><span style="display:flex;"><span>          <span style="color:#ca9ee6">name-server</span>: ${rocket-mq.name-server}  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">bindings</span>:  
</span></span><span style="display:flex;"><span>          <span style="color:#ca9ee6">output</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">producer</span>:  
</span></span><span style="display:flex;"><span>              <span style="color:#ca9ee6">group</span>: socketGroup  
</span></span><span style="display:flex;"><span>              <span style="color:#ca9ee6">sync</span>: <span style="color:#ef9f76">true</span>  
</span></span><span style="display:flex;"><span>      <span style="color:#ca9ee6">bindings</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">output</span>:  
</span></span><span style="display:flex;"><span>          <span style="color:#ca9ee6">destination</span>: test-topic  
</span></span><span style="display:flex;"><span>          <span style="color:#ca9ee6">content-type</span>: application/json  
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">#开启MQ的日志  </span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">logging</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">level</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">com</span>:  
</span></span><span style="display:flex;"><span>      <span style="color:#ca9ee6">alibaba</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">cloud</span>:  
</span></span><span style="display:flex;"><span>          <span style="color:#ca9ee6">stream</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">binder</span>:  
</span></span><span style="display:flex;"><span>              <span style="color:#ca9ee6">rocketmq</span>: DEBUG
</span></span></code></pre></div><p>项目依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;artifactId&gt;</span>spring-cloud-starter-stream-rocketmq<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>写 <code>Swagger</code> 配置, 不同于 <code>webSocket</code> mq作为异步消息组件可以用C-S模型, 也就是请求-响应模型, 我们从 swagger测试请求响应</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;p&gt; * 描述：Swagger配置  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;/p&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @version 1.0.0  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span><span style="color:#8caaee;font-weight:bold">@Configuration</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableSwagger2WebMvc</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">SwaggerConfig</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Bean</span>  
</span></span><span style="display:flex;"><span>    Docket <span style="color:#8caaee">rpApi</span>() {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> SwaggerCore.<span style="color:#8caaee">defaultDocketBuilder</span>(<span style="color:#a6d189">&#34;消息推送&#34;</span>, <span style="color:#a6d189">&#34;com.zeroone.star.mq.controller&#34;</span>, <span style="color:#a6d189">&#34;publish&#34;</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>消息发布组件 <code>RmqPublish</code> , 该组件封装了发布方法</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;p&gt; * 描述：消息发布组件  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;/p&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @version 1.0.0  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span><span style="color:#8caaee;font-weight:bold">@Component</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">RmqPublish</span> {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Resource</span>  
</span></span><span style="display:flex;"><span>    Source source;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">publish</span>(SampleNotifyDTO dto) {  
</span></span><span style="display:flex;"><span>        source.<span style="color:#8caaee">output</span>().<span style="color:#8caaee">send</span>(MessageBuilder.<span style="color:#8caaee">withPayload</span>(dto).<span style="color:#8caaee">build</span>());  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这里通知DTO封装的是 <code>websocket</code> 的客户端id 和消息</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;p&gt; * 描述：示例通知数据对象  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * &lt;/p&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @version 1.0.0  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span><span style="color:#8caaee;font-weight:bold">@Data</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">SampleNotifyDTO</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">     * 客户端编号  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> String clientId;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">     * 通知消息内容  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> String message;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>继续之前, 我们要解释一下发布组件</p>
<ul>
<li><code>@Component</code> 是声明式注解, 要求 <code>Spring</code> 作为组件注入</li>
<li>通过 <code>@Resourse</code> 注入了一个依赖, 该注解会查找指定名称的资源/Bean, 如果不指定就通过反射拿指定类型的资源, 这里查找到了一个 <code>Source</code></li>
<li><code>Source</code> 接口返回一个 <code>MessageChannel</code> 这个可以理解为发送消息到消息队列</li>
<li>构建信息后链式调用 output 返回一个 MC, 调用MC发送信息</li>
</ul>
<p>Source 信息源接口如下</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250224211221207.png" alt="image.png"></p>
<p>其中 <code>@OutPut</code> 注解 要求 <code>Spring</code> 容器将名字为 <code>OUTPUT</code> 值的消息频道与中间件绑定</p>
<p>因此这里我们需要做一些配置</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">rocketmq</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">binder</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">name-server</span>: ${rocket-mq.name-server}  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">bindings</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">output</span>:  
</span></span><span style="display:flex;"><span>      <span style="color:#ca9ee6">producer</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">group</span>: socketGroup  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">sync</span>: <span style="color:#ef9f76">true</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">bindings</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">output</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">destination</span>: test-topic  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">content-type</span>: application/json
</span></span></code></pre></div><p>我们先看<code>mq</code>的配置</p>
<p><code>spring.cloud.rocketmq</code> 下配置名称服务器地址, 这里已经通过 <code>nacos</code> 配置好了</p>
<blockquote>
<p><strong>RocketMQ</strong> 的 <strong>NameServer</strong> 是 RocketMQ 集群中的一个核心组件，它提供了一个简单的服务注册与发现机制。具体来说，<strong>NameServer</strong> 主要用于管理 RocketMQ Broker 的信息，客户端通过访问 NameServer 来查询和获取消息队列的路由信息，从而实现消息的发送和接收。</p></blockquote>
<p>这是为了让 Spring Cloud Stream 知道如何将消息发送到 RocketMQ</p>
<p>之后再配置  <code>bindings.output</code> 下配置生产者</p>
<ul>
<li><code>producer.group</code>: 配置生产者的 <strong>消费组</strong>，用于指定该生产者的分组。</li>
<li><code>sync</code>: 如果设置为 <code>true</code>，则表示生产者将同步发送消息。即，发送消息后会等待消息发送确认，确保消息发送成功。</li>
</ul>
<blockquote>
<p>生产者就是在 RocketMQ 中生产信息的角色</p></blockquote>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250224212653226.png" alt="image.png"></p>
<p>然后是第二个 <code>bindings</code>, 这是 Spring Cloud 的配置</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">bindings</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">output</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">destination</span>: test-topic  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">content-type</span>: application/json
</span></span></code></pre></div><p>这里的 <code>output</code> 配置与 <code>Source.OUTPUT</code> 直接相关。通过这个配置，Spring Cloud Stream 会将 <code>Source.OUTPUT</code> 这个输出通道的 <strong>消息目标</strong>（即 <code>destination</code>）设置为 <code>test-topic</code>，并且设置消息的 <strong>内容类型</strong> 为 <code>application/json</code>。这意味着，消息将通过名为 <code>output</code> 的通道发送到 <code>test-topic</code> 主题，并且消息格式是 JSON。</p>
<p>总结下, 为了保证代码松耦合, Spring 将消息发送和驱动(也就是连接不同品牌的MQ)分离开, 将驱动交由第三方提供. spring只需要调用Source发送消息即可</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6847462fbc45c0ec0e2539734fdfc520">3 - AOP面向切面编程</h1>
    <div class="lead">The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the aspect. Aspects enable the modularization of concerns (such as transaction management) that cut across multiple types and objects.</div>
	<p>Aspect-oriented Programming (AOP) complements Object-oriented Programming (OOP) by providing another way of thinking about program structure.</p>
<p>AOP是OOP的延续, 两者互补</p>
<p>为什么要用AOP
为了不涉及过多术语, 在介绍AOP之前, 我们介绍下为什么要提出AOP这个概念</p>
<p>OOP作为Java的核心设计原则, 是存在一些缺点的.
比如日志, 我们知道可以用slf4j 提供的工厂发法返回logger,
但是这个logger的作用范围是初始化的类, 为了实现全局日志需要在所有业务类注入这个logger, 也就是@Slf4j注解
这会导致代码冗余</p>
<p>类似的还有 <a href="/java/advanced/%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/">事务管理</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5ba10e92aedbfc888e0e1fc25ad92362">4 - FastExcel报表组件</h1>
    <div class="lead">报表组件</div>
	<p>提前封装好一些服务</p>
<h4 id="快速导入">快速导入<a class="td-heading-self-link" href="#%e5%bf%ab%e9%80%9f%e5%af%bc%e5%85%a5" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>组件扫描</p>
<p>写一个单元测试
导入excel客户端
生成excle
新建一个数组
调用导入功能</p>
<p>解析
传入文件</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2b22ec5ab6cb18f57e4a05415d0a34e2">5 - Gateway网关</h1>
    <div class="lead">网关是一个位于微服务架构前端的组件，它充当了所有微服务的入口</div>
	<h4 id="什么是网关">什么是网关<a class="td-heading-self-link" href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%bd%91%e5%85%b3" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>网关负责路由请求、负载均衡、安全认证、流量控制、监控和日志记录等任务。</p>
<p>我的理解是, 网关是请求真正进入服务前的过滤, 管理, 控制(重定向), 可以理解为保安大哥</p>
<p>网关的结构</p>
<ul>
<li>
<p>路由
网关的基本模块, 由断言和过滤器组成</p>
<ul>
<li>
<p>断言
匹配规则, 当请求路径匹配时允许路由到相关服务
实现一组匹配规则，让请求找到对应的 Route 进行处理</p>
</li>
<li>
<p>过滤器
响应式的过滤器链, 实现请求的过滤</p>
<ul>
<li>全局过滤器
全局过滤器作用于所有的路由，不需要单独配置</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250212093859168.png" alt="image.png"></p>
<p>客户端发起请求, 由 <code>Gateway Handler Mapping</code>
接收, 这里执行断言并路由到 <code>Gateway Web Handler</code> 这里做过滤链, 过滤请求, 最后传递给服务
过滤器可以在执行前和执行后回调</p>
<blockquote>
<p>在“pre”类型的过滤器可以做参数校验、权限校验、流量监控、日志输出、协议转换等;</p>
<p>在“post”类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流量监控等有着非常重要的作用。</p></blockquote>
<blockquote>
<p>了解:
<a href="/java/advanced/reactor%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%BA%93/">响应式编程</a></p></blockquote>
<h4 id="过滤器">过滤器<a class="td-heading-self-link" href="#%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>过滤器是由 <code>Servlet</code> 容器管理的, 也就是说初始化</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250217183936830.png" alt="image.png"></p>
<h4 id="实践-spring-cloud-gateway-全局过滤器">实践: Spring Cloud Gateway 全局过滤器<a class="td-heading-self-link" href="#%e5%ae%9e%e8%b7%b5-spring-cloud-gateway-%e5%85%a8%e5%b1%80%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><blockquote>
<p>网关选型<code>SpringCloudGateway</code> 这是目前比较新的选择</p>
<p>模板工程基于 <code>pmhub</code></p></blockquote>
<p>新建自定义的全局过滤器</p>
<p>全局过滤器需要实现 <code>GlobalFilter</code>
过滤器需要确定执行顺序, 实现<code>Order</code> 接口</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered
</span></span></code></pre></div><p>该过滤器实现如下功能</p>
<ol>
<li>请求耗时记录</li>
<li>白名单过滤</li>
<li>Token鉴权</li>
<li>日志输出</li>
</ol>
<p>请求耗时记录:</p>
<p>全局过滤器的优先级较高, 因此把请求进入过滤器的时间作为起点, 业务执行完毕执行<code>post</code> 业务逻辑. 进行简单的时间相减</p>
<p>白名单过滤:</p>
<p><a href="/java/advanced/nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"><code>nacos</code></a> 配置白名单, 有些路径不需要严格的鉴权, 比如首页. 所有人发请求都能通过, 就直接跳过完事</p>
<p><code>Token</code>鉴权:</p>
<p>作为全局过滤器, 当用户请求进入应当进行身份鉴权, 过滤无效的请求
从请求头里拿 <code>Token</code> , 跟缓存做匹配即可</p>
<blockquote>
<p><code>Redis</code> 策略是到期销毁, 不做更新</p></blockquote>
<p>日志输出:
在过滤链回调后执行, 代表服务执行完成
结束时间减去开始时间就行</p>
<p>为了方便解释, 我们一项项实现</p>
<p>请求耗时:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered{
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//常量, 记录开始访问的时间</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> String BEGIN_VISIT_TIME <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;begin_visit_time&#34;</span>;<span style="color:#737994;font-style:italic">//开始访问时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上日志实例</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Logger log <span style="color:#99d1db;font-weight:bold">=</span> LoggerFactory.<span style="color:#8caaee">getLogger</span>(AuthFilter.<span style="color:#8caaee">class</span>);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//过滤器接口方法, 这个必须实现</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> Mono<span style="color:#99d1db;font-weight:bold">&lt;</span>Void<span style="color:#99d1db;font-weight:bold">&gt;</span> <span style="color:#8caaee">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//token和白名单稍后实现</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//在上下文加上开始时间</span>
</span></span><span style="display:flex;"><span>	exchange.<span style="color:#8caaee">getAttributes</span>().<span style="color:#8caaee">put</span>(BEGIN_VISIT_TIME, System.<span style="color:#8caaee">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//等待链执行完成回调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange)
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//链式调用then, 使用Mono.fromRunnable方法顺序执行日志输出</span>
</span></span><span style="display:flex;"><span>	.<span style="color:#8caaee">then</span>(Mono.<span style="color:#8caaee">fromRunnable</span>{})
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">//日志输出的逻辑</span>
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">// 记录接口访问日志  </span>
</span></span><span style="display:flex;"><span>		Long beginVisitTime <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getAttribute</span>(BEGIN_VISIT_TIME);
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> (beginVisitTime <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>){
</span></span><span style="display:flex;"><span>			logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;duration&#34;</span>, (System.<span style="color:#8caaee">currentTimeMillis</span>() <span style="color:#99d1db;font-weight:bold">-</span> beginVisitTime) <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;ms&#34;</span>);
</span></span><span style="display:flex;"><span>			log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;访问接口信息: {}&#34;</span>, logData);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>白名单过滤</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered{
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//常量, 记录开始访问的时间</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> String BEGIN_VISIT_TIME <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;begin_visit_time&#34;</span>;<span style="color:#737994;font-style:italic">//开始访问时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上日志</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Logger log <span style="color:#99d1db;font-weight:bold">=</span> LoggerFactory.<span style="color:#8caaee">getLogger</span>(AuthFilter.<span style="color:#8caaee">class</span>);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//过滤器接口方法</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> Mono<span style="color:#99d1db;font-weight:bold">&lt;</span>Void<span style="color:#99d1db;font-weight:bold">&gt;</span> <span style="color:#8caaee">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//白名单</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//首先拿到请求路径</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//上下文拿请求</span>
</span></span><span style="display:flex;"><span>	ServerHttpRequest request <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getRequest</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//请求拿请求路径, 先拿URI, 再去掉首部</span>
</span></span><span style="display:flex;"><span>	String url <span style="color:#99d1db;font-weight:bold">=</span> request.<span style="color:#8caaee">getURI</span>().<span style="color:#8caaee">getPath</span>();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// 跳过不需要验证的路径, 直接进下一级</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">matches</span>(url, ignoreWhite.<span style="color:#8caaee">getWhites</span>())) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//在上下文加上开始时间</span>
</span></span><span style="display:flex;"><span>	exchange.<span style="color:#8caaee">getAttributes</span>().<span style="color:#8caaee">put</span>(BEGIN_VISIT_TIME, System.<span style="color:#8caaee">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//等待链执行完成回调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange)
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//链式调用then, 使用Mono.fromRunnable方法顺序执行日志输出</span>
</span></span><span style="display:flex;"><span>	.<span style="color:#8caaee">then</span>(Mono.<span style="color:#8caaee">fromRunnable</span>{})
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">//日志输出的逻辑</span>
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">// 记录接口访问日志  </span>
</span></span><span style="display:flex;"><span>		Long beginVisitTime <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getAttribute</span>(BEGIN_VISIT_TIME);
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> (beginVisitTime <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>){
</span></span><span style="display:flex;"><span>			logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;duration&#34;</span>, (System.<span style="color:#8caaee">currentTimeMillis</span>() <span style="color:#99d1db;font-weight:bold">-</span> beginVisitTime) <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;ms&#34;</span>);
</span></span><span style="display:flex;"><span>			log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;访问接口信息: {}&#34;</span>, logData);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>token鉴权:
选型 <a href="/java/advanced/jwt%E4%B8%8Esession/"><code>Jwt</code></a></p>
<p>下图是流程, 我们将鉴权的业务从服务层分离移至网关进行, 优化性能</p>
<p><strong>鉴权（认证）是在网关层进行的</strong>，而 <strong>请求并没有进入到 MVC 控制器中</strong>, 也就没有触发拦截器</p>
<blockquote>
<p>了解:
<a href="/java/advanced/springmvc/">SpringMVC</a></p></blockquote>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250218002926038.png" alt="image.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered{
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//常量, 记录开始访问的时间</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> String BEGIN_VISIT_TIME <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;begin_visit_time&#34;</span>;<span style="color:#737994;font-style:italic">//开始访问时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上日志</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Logger log <span style="color:#99d1db;font-weight:bold">=</span> LoggerFactory.<span style="color:#8caaee">getLogger</span>(AuthFilter.<span style="color:#8caaee">class</span>);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上redis</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Autowired</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> RedisService redisService;
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//过滤器接口方法</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> Mono<span style="color:#99d1db;font-weight:bold">&lt;</span>Void<span style="color:#99d1db;font-weight:bold">&gt;</span> <span style="color:#8caaee">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//白名单</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//首先拿到请求路径</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//上下文拿请求</span>
</span></span><span style="display:flex;"><span>	ServerHttpRequest request <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getRequest</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//请求拿请求路径, 先拿URI, 再去掉首部</span>
</span></span><span style="display:flex;"><span>	String url <span style="color:#99d1db;font-weight:bold">=</span> request.<span style="color:#8caaee">getURI</span>().<span style="color:#8caaee">getPath</span>();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// 跳过不需要验证的路径, 直接进下一级, 返回链的执行结果</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">matches</span>(url, ignoreWhite.<span style="color:#8caaee">getWhites</span>())) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//剩下的请求过筛子</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//从请求拿token</span>
</span></span><span style="display:flex;"><span>	String token <span style="color:#99d1db;font-weight:bold">=</span> getToken(request);
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">isEmpty</span>(token)) {  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;令牌不能为空&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//拿JWT的声明, 这里写了一个字符串工具拿声明, 令牌秘钥就在工具里</span>
</span></span><span style="display:flex;"><span>	Claims claims <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">parseToken</span>(token);
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (claims <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;令牌已过期或验证不正确！&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//从声明拿用户ID</span>
</span></span><span style="display:flex;"><span>	String userkey <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">getUserKey</span>(claims);  
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//从缓存匹配用户ID的token, 这里getTokenKey格式化, 就加了个前缀</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">boolean</span> islogin <span style="color:#99d1db;font-weight:bold">=</span> redisService.<span style="color:#8caaee">hasKey</span>(getTokenKey(userkey));
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (<span style="color:#99d1db;font-weight:bold">!</span>islogin) {  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;登录状态已过期&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//最后从声明拿用户详细信息</span>
</span></span><span style="display:flex;"><span>	String userid <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">getUserId</span>(claims);  
</span></span><span style="display:flex;"><span>	String username <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">getUserName</span>(claims);  
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">isEmpty</span>(userid) <span style="color:#99d1db;font-weight:bold">||</span> StringUtils.<span style="color:#8caaee">isEmpty</span>(username)) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;令牌验证失败&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//重新设置请求, 鉴权完毕</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//设置用户信息到请求  </span>
</span></span><span style="display:flex;"><span>	addHeader(mutate, SecurityConstants.<span style="color:#8caaee">USER_KEY</span>, userkey);  
</span></span><span style="display:flex;"><span>	addHeader(mutate, SecurityConstants.<span style="color:#8caaee">DETAILS_USER_ID</span>, userid);  
</span></span><span style="display:flex;"><span>	addHeader(mutate, SecurityConstants.<span style="color:#8caaee">DETAILS_USERNAME</span>, username);  
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// 内部请求来源参数清除（防止网关携带内部请求标识，造成系统安全风险）  </span>
</span></span><span style="display:flex;"><span>	removeHeader(mutate, SecurityConstants.<span style="color:#8caaee">FROM_SOURCE</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//在上下文加上开始时间</span>
</span></span><span style="display:flex;"><span>	exchange.<span style="color:#8caaee">getAttributes</span>().<span style="color:#8caaee">put</span>(BEGIN_VISIT_TIME, System.<span style="color:#8caaee">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//等待链执行完成回调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange)
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//链式调用then, 使用Mono.fromRunnable方法顺序执行日志输出</span>
</span></span><span style="display:flex;"><span>	.<span style="color:#8caaee">then</span>(Mono.<span style="color:#8caaee">fromRunnable</span>{})
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">//日志输出的逻辑</span>
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">// 记录接口访问日志  </span>
</span></span><span style="display:flex;"><span>		Long beginVisitTime <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getAttribute</span>(BEGIN_VISIT_TIME);  
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> (beginVisitTime <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>		    URI uri <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getRequest</span>().<span style="color:#8caaee">getURI</span>();  
</span></span><span style="display:flex;"><span>		    Map<span style="color:#99d1db;font-weight:bold">&lt;</span>String, Object<span style="color:#99d1db;font-weight:bold">&gt;</span> logData <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> HashMap<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;host&#34;</span>, uri.<span style="color:#8caaee">getHost</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;port&#34;</span>, uri.<span style="color:#8caaee">getPort</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;path&#34;</span>, uri.<span style="color:#8caaee">getPath</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;query&#34;</span>, uri.<span style="color:#8caaee">getRawQuery</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;duration&#34;</span>, (System.<span style="color:#8caaee">currentTimeMillis</span>() <span style="color:#99d1db;font-weight:bold">-</span> beginVisitTime) <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;ms&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>		    log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;访问接口信息: {}&#34;</span>, logData);  
</span></span><span style="display:flex;"><span>		    log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;我是美丽分割线: ###################################################&#34;</span>);  
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>addHeader</code> 和 <code>removeHeader</code> 其实没什么说的, 就是重新构造了个请求, 方便后续服务直接拿信息</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">addHeader</span>(ServerHttpRequest.<span style="color:#8caaee">Builder</span> mutate, String name, Object value) {  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (value <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    String valueStr <span style="color:#99d1db;font-weight:bold">=</span> value.<span style="color:#8caaee">toString</span>();  
</span></span><span style="display:flex;"><span>    String valueEncode <span style="color:#99d1db;font-weight:bold">=</span> ServletUtils.<span style="color:#8caaee">urlEncode</span>(valueStr);  
</span></span><span style="display:flex;"><span>    mutate.<span style="color:#8caaee">header</span>(name, valueEncode);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">removeHeader</span>(ServerHttpRequest.<span style="color:#8caaee">Builder</span> mutate, String name) {  
</span></span><span style="display:flex;"><span>    mutate.<span style="color:#8caaee">headers</span>(httpHeaders <span style="color:#99d1db;font-weight:bold">-&gt;</span> httpHeaders.<span style="color:#8caaee">remove</span>(name)).<span style="color:#8caaee">build</span>();  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a10ef0a98cd31d88eed3637bec2fff46">6 - Intercepter拦截器</h1>
    <div class="lead">拦截器 Interceptor 在 Spring MVC 中的地位等同于 Servlet 规范中的过滤器 Filter，拦截的是处理器的执行，由于是全局行为，因此常用于做一些通用的功能，如请求日志打印、权限控制等。</div>
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ed66f29438332c88139caba654f9e301">7 - JWT与Session</h1>
    <div class="lead">一种令牌格式, 改进了 Session 需要状态管理的缺点, 通过用户提供token来实现令牌发放</div>
	<p>作为令牌格式, JWT 和 session 在用户认证上时常用到</p>
<h4 id="session">Session<a class="td-heading-self-link" href="#session" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>经典的 <code>Session</code> 登录流程如下</p>
<ul>
<li>
<p>用户向服务器发送用户名和密码。</p>
</li>
<li>
<p>服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</p>
</li>
<li>
<p>服务器向用户返回一个 session_id，写入用户的 Cookie。</p>
</li>
<li>
<p>用户随后的每一次请求，都会通过 Cookie，将 <code>session_id</code> 传回服务器。</p>
</li>
<li>
<p>服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</p>
</li>
</ul>
<p>单机环境下, session 实现简单, 方便快速, 服务器维护与用户的连接(下称 <code>Sesssion</code>), 用户传入 id 来更新session</p>
<p>但是分布式集群下, 各个服务需要不断的请求并写入session, 这使得session服务器成为了登录中心服务器, 一旦中心服务器挂了, 整个分布应用宕机</p>
<p>既然服务器维护session成本这么高, 干脆不维护了, 让用户维护</p>
<p>于是诞生了 JWT</p>
<h4 id="jwt">JWT<a class="td-heading-self-link" href="#jwt" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">&#34;姓名&#34;</span>: <span style="color:#a6d189">&#34;张三&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">&#34;角色&#34;</span>: <span style="color:#a6d189">&#34;管理员&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">&#34;到期时间&#34;</span>: <span style="color:#a6d189">&#34;2018年7月1日0点0分&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-14466de61718f3e7e4e0634fcd427c5f">8 - Nacos配置中心</h1>
    <div class="lead">动态决策中心, 当然可以理解为分布式的配置中心</div>
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bfce5c28aec1143b74ff0aa46a5285a4">9 - OAuth2认证</h1>
    <div class="lead">OAuth 2.0, which stands for “Open Authorization”, is a standard designed to allow a website or application to access resources hosted by other web apps on behalf of a user.</div>
	<p><a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a>是一个关于授权（authorization）的开放网络标准，在全世界得到广泛应用，目前的版本是2.0版。</p>
<h4 id="为什么需要-oauth">为什么需要 <code>OAuth</code><a class="td-heading-self-link" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81-oauth" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>以网易云音乐云村账号登录为例</p>
<p>传统的用户授权方式是</p>
<ul>
<li>用户输入用户名密码</li>
<li>服务器验证密码, 这里需要存储用户密码到本地</li>
<li>返回session/token</li>
</ul>
<p>这对于单一服务没什么问题, 因为用户敏感信息和服务都是由网易云存储并提供的</p>
<p>但是网易云也支持qq登录</p>
<p>按照常识, 用户不会把qq密码提供给网易, 没别的意思, 就是不合逻辑
那么上述流程就存在问题了</p>
<ul>
<li>网易云为了实现qq登录, 不得不保存qq用户信息并部署qq密码登录</li>
<li>网易获得了登录用户qq的权限</li>
<li>qq密码权限范围被意外扩大了, 现在不止腾讯, 网易也可以获取密码了, 被破解的几率增加</li>
</ul>
<p>所以我们需要在网易和腾讯之间设置一个转换层, 密码在腾讯处理, 通过转换层把令牌交给网易</p>
<h4 id="角色介绍">角色介绍<a class="td-heading-self-link" href="#%e8%a7%92%e8%89%b2%e4%bb%8b%e7%bb%8d" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>OAuth 就是这样的一种协议</p>
<p>此协议定义了四种角色</p>
<ul>
<li>客户端/客户, 一个应用程序发出 API 请求对受保护资源执行一些行为，而这些行为是经过资源拥有授权的</li>
<li>资源拥有者Resource owner)：通常是一个应用的用户，也是资源拥有者，它拥有授予访问在资源 服务器上的资源</li>
<li>授权服务器Authorization server)：当前授权服务器从资源拥有者达成共识时，它会发放访问令牌 给客户以允许访问在资源服务器上的受保护的资源 。比较小的 API 提供商可能会使用相同的应用和 URL空间作为授权服务器和资源服务器</li>
<li>资源服务器Resource server)：该服务器是用户拥有资源的服务器，它是受 一般我们叫做 OAuth 保护的服务器。 API 提供商，因为它拥有受保护的数据，比如图片、视频、日历或者合同等。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250302235946977.png" alt="image.png"></p>
<p>OAuth  的优点包括简化了用户授权流程，提高了安全性，允许用户选择性地授权资源访问，并支持多 种授权方式（如授权码模式、密码模式、客户端模式等）。它广泛应用于各种互联网应用程序中，例如第 三方登录、 API 访问授权等场景。</p>
<h4 id="实践--spring-cloud-gateway--密码模式的-oauth2-授权模型">实践:  Spring Cloud GateWay + 密码模式的 OAuth2 授权模型<a class="td-heading-self-link" href="#%e5%ae%9e%e8%b7%b5--spring-cloud-gateway--%e5%af%86%e7%a0%81%e6%a8%a1%e5%bc%8f%e7%9a%84-oauth2-%e6%8e%88%e6%9d%83%e6%a8%a1%e5%9e%8b" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><blockquote>
<p><a href="/java/advanced/gateway%E7%BD%91%E5%85%B3/">网关</a>, <a href="/java/advanced/jwt%E4%B8%8Esession/">JWT与Session</a></p></blockquote>
<blockquote>
<p>警告: 最新的 OAuth 废弃了密码模式鉴权, 此种方法会将密码暴露给客户端</p></blockquote>
<p>搭建认证服务模块 <code>OAuth2</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"></code></pre></div><p>配置文件</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"></code></pre></div><p>OAuth2 要求使用 JWT 作为令牌格式, 这里需要 RSA 证书</p>
<pre tabindex="0"><code class="language-key" data-lang="key"></code></pre><p>提取公/私钥</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7784bca3c26210aa2f38f471a8a3c1c4">10 - SpringMVC</h1>
    <div class="lead">MVC 也就是 Model-View-Controller, 这种模式用于应用程序的分层开发</div>
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c5be60b3ee2566487eb164b032000197">11 - TTL</h1>
    <div class="lead">基于 TransmittableThreadLocal (TTL) 自定义请求头拦截器，将Header 数据封装到线程变量中方便获取，减少用户信息数据库查询次数，同时验证当前用户有效期自动刷新有效期。</div>
	<p><code>TransmittableThreadLocal</code> (TTL) 是增强版的 <code>ThreadLocal</code></p>
<blockquote>
<p>前置:
<a href="ThreadLocal.md"><code>ThreadLocal</code></a>, <a href="/java/advanced/intercepter%E6%8B%A6%E6%88%AA%E5%99%A8/">拦截器</a></p></blockquote>
<h4 id="实现ttl">实现<code>TTL</code><a class="td-heading-self-link" href="#%e5%ae%9e%e7%8e%b0ttl" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>流程图如下</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250216213034195.png" alt="image.png"></p>
<blockquote>
<p>前置:
<a href="/java/advanced/gateway%E7%BD%91%E5%85%B3/">Gateway网关</a></p></blockquote>
<p>上半部分业务为用户请求登录并返回<code>Token</code> 该业务从MVC剥离, 设置在网关进行</p>
<p>我们主要关注下半部分, 用户携带 <code>Token</code> 后如何在服务层获取用户信息</p>
<p>整体流程为:</p>
<ul>
<li>
<p><strong>用户登录请求</strong>：</p>
<ul>
<li>用户通过提交用户名和密码进行登录，经过网关的认证，认证服务（如 <code>Auth</code>）验证用户身份并生成 <code>token</code>。</li>
<li>登录请求返回 <code>token</code> 给用户，用户保存 <code>token</code>。</li>
</ul>
</li>
<li>
<p><strong>后续请求携带 Token 登录</strong>：</p>
<ul>
<li>用户在后续请求中携带该 <code>token</code>，这个 <code>token</code> 用于证明用户的身份。</li>
</ul>
</li>
<li>
<p><strong>Nginx 负载均衡</strong>：</p>
<ul>
<li>请求首先被发送到 <code>Nginx</code>，Nginx 会根据负载均衡策略将请求转发到具体的 <strong>网关</strong>（<code>Gateway</code>）。</li>
</ul>
</li>
<li>
<p><strong>网关鉴权</strong>：</p>
<ul>
<li>网关负责根据请求中的 <code>token</code> 进行 <strong>鉴权</strong>，验证该 <code>token</code> 是否有效。如果验证通过，网关会继续转发请求；如果验证失败，则拒绝请求或重定向至登录页面。</li>
</ul>
</li>
<li>
<p><strong>拦截器将用户信息放入 TTL</strong>：</p>
<ul>
<li>在请求经过网关后，网关会调用拦截器（如 <code>HeaderInterceptor</code>）。拦截器会提取请求中的用户信息（如 <code>token</code> 解密后的用户信息），然后将这些信息存放到 <strong>TTL</strong>（Thread-Local）中。</li>
<li>TTL 是一种线程局部存储机制，用于在当前线程内传递数据，确保在同一请求的生命周期内，后续的服务（如 <code>ProjectService</code> 等）能够访问到这些用户信息。</li>
</ul>
</li>
<li>
<p><strong>后续服务从 TTL 获取用户信息</strong>：</p>
<ul>
<li>后续的服务（如 <code>ProjectService</code>）可以通过访问当前线程的 <strong>TTL</strong> 中的数据来获取用户信息，而无需每次都从请求中提取或解析 <code>token</code>。</li>
</ul>
</li>
</ul>
<p>我们所关注的 TTL 在拦截器里实现</p>
<p>新建 <code>HeaderInterceptor.java</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">HeaderInterceptor</span> <span style="color:#e78284">implements</span> AsyncHandlerInterceptor
</span></span></code></pre></div><p>该拦截器实现了拦截器接口, 该业务在请求执行之前执行拦截业务逻辑, 所以重写 <code>preHandle</code> 在请求执行完毕后需要删除用户信息, 所以重写 <code>afterCompletion</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">HeaderInterceptor</span> <span style="color:#e78284">implements</span> AsyncHandlerInterceptor {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">boolean</span> <span style="color:#8caaee">preHandle</span>(HttpServletRequest request, HttpServletResponse response, Object handler) <span style="color:#e78284">throws</span> Exception {  }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">afterCompletion</span>(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">throws</span> Exception {  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>首先是 <code>preHandle</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">boolean</span> <span style="color:#8caaee">preHandle</span>(HttpServletRequest request, HttpServletResponse response, Object handler) <span style="color:#e78284">throws</span> Exception {  
</span></span><span style="display:flex;"><span>	  <span style="color:#737994;font-style:italic">//不是控制器方法不拦截</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (<span style="color:#99d1db;font-weight:bold">!</span>(handler <span style="color:#ca9ee6">instanceof</span> HandlerMethod)) {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> <span style="color:#ef9f76">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//自定义holder 用来设置信息  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SecurityContextHolder.<span style="color:#8caaee">setUserId</span>(ServletUtils.<span style="color:#8caaee">getHeader</span>(request, SecurityConstants.<span style="color:#8caaee">DETAILS_USER_ID</span>));  
</span></span><span style="display:flex;"><span>    SecurityContextHolder.<span style="color:#8caaee">setUserName</span>(ServletUtils.<span style="color:#8caaee">getHeader</span>(request, SecurityConstants.<span style="color:#8caaee">DETAILS_USERNAME</span>));  
</span></span><span style="display:flex;"><span>    SecurityContextHolder.<span style="color:#8caaee">setUserKey</span>(ServletUtils.<span style="color:#8caaee">getHeader</span>(request, SecurityConstants.<span style="color:#8caaee">USER_KEY</span>));
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//根据Token创建用户</span>
</span></span><span style="display:flex;"><span>    String token <span style="color:#99d1db;font-weight:bold">=</span> SecurityUtils.<span style="color:#8caaee">getToken</span>();  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">isNotEmpty</span>(token)) {  
</span></span><span style="display:flex;"><span>        LoginUser loginUser <span style="color:#99d1db;font-weight:bold">=</span> AuthUtil.<span style="color:#8caaee">getLoginUser</span>(token);  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">isNotNull</span>(loginUser)) {  
</span></span><span style="display:flex;"><span>            AuthUtil.<span style="color:#8caaee">verifyLoginUserExpire</span>(loginUser);  
</span></span><span style="display:flex;"><span>            SecurityContextHolder.<span style="color:#8caaee">set</span>(SecurityConstants.<span style="color:#8caaee">LOGIN_USER</span>, loginUser);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    } <span style="color:#ca9ee6">else</span> {  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">// 首页免登场景展示  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">// 检查请求路径是否匹配特定路径  </span>
</span></span><span style="display:flex;"><span>        String requestURI <span style="color:#99d1db;font-weight:bold">=</span> request.<span style="color:#8caaee">getRequestURI</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (isExemptedPath(requestURI)) {  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">// 创建一个默认的 LoginUser 对象  </span>
</span></span><span style="display:flex;"><span>            LoginUser defaultLoginUser <span style="color:#99d1db;font-weight:bold">=</span> createDefaultLoginUser();  
</span></span><span style="display:flex;"><span>            SecurityContextHolder.<span style="color:#8caaee">set</span>(SecurityConstants.<span style="color:#8caaee">LOGIN_USER</span>, defaultLoginUser);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> <span style="color:#ef9f76">true</span>;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这里使用 TTL的就是 设置信息的工具类</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">SecurityContextHolder</span>{
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//TTL</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> TransmittableThreadLocal<span style="color:#99d1db;font-weight:bold">&lt;</span>Map<span style="color:#99d1db;font-weight:bold">&lt;</span>String, Object<span style="color:#99d1db;font-weight:bold">&gt;&gt;</span> THREAD_LOCAL <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> TransmittableThreadLocal<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//设置方法, 在线程Map中存储私有信息</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">set</span>(String key, Object value)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    Map<span style="color:#99d1db;font-weight:bold">&lt;</span>String, Object<span style="color:#99d1db;font-weight:bold">&gt;</span> map <span style="color:#99d1db;font-weight:bold">=</span> getLocalMap();  
</span></span><span style="display:flex;"><span>    map.<span style="color:#8caaee">put</span>(key, value <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span> <span style="color:#99d1db;font-weight:bold">?</span> StringUtils.<span style="color:#8caaee">EMPTY</span> : value);  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//这里只就一个例子, 存储固定的用户名前缀和用户名的方法</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">setUserName</span>(String username)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    set(SecurityConstants.<span style="color:#8caaee">DETAILS_USERNAME</span>, username);  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>最后添加其他方法</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">static</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">// 在这里添加所有需要免登录默认展示首页的的路径  </span>
</span></span><span style="display:flex;"><span>    EXEMPTED_PATHS.<span style="color:#8caaee">add</span>(<span style="color:#a6d189">&#34;/system/user/getInfo&#34;</span>);  
</span></span><span style="display:flex;"><span>    EXEMPTED_PATHS.<span style="color:#8caaee">add</span>(<span style="color:#a6d189">&#34;/project/statistics&#34;</span>);  
</span></span><span style="display:flex;"><span>    EXEMPTED_PATHS.<span style="color:#8caaee">add</span>(<span style="color:#a6d189">&#34;/project/doing&#34;</span>);  
</span></span><span style="display:flex;"><span>    EXEMPTED_PATHS.<span style="color:#8caaee">add</span>(<span style="color:#a6d189">&#34;/project/queryMyTaskList&#34;</span>);  
</span></span><span style="display:flex;"><span>    EXEMPTED_PATHS.<span style="color:#8caaee">add</span>(<span style="color:#a6d189">&#34;/project/select&#34;</span>);  
</span></span><span style="display:flex;"><span>    EXEMPTED_PATHS.<span style="color:#8caaee">add</span>(<span style="color:#a6d189">&#34;/system/menu/getRouters&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// 需要免登录的路径集合  </span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Set<span style="color:#99d1db;font-weight:bold">&lt;</span>String<span style="color:#99d1db;font-weight:bold">&gt;</span> EXEMPTED_PATHS <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> HashSet<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// 判断请求路径是否匹配特定路径, 也就是免密白名单  </span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">boolean</span> <span style="color:#8caaee">isExemptedPath</span>(String requestURI) {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">// 你可以根据需要调整特定路径的匹配逻辑  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> EXEMPTED_PATHS.<span style="color:#8caaee">stream</span>().<span style="color:#8caaee">anyMatch</span>(requestURI::startsWith);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// 创建一个默认的 LoginUser 对象  </span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> LoginUser <span style="color:#8caaee">createDefaultLoginUser</span>() {  
</span></span><span style="display:flex;"><span>    LoginUser defaultLoginUser <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> LoginUser();  
</span></span><span style="display:flex;"><span>    defaultLoginUser.<span style="color:#8caaee">setUserId</span>(173L);  <span style="color:#737994;font-style:italic">// 设置默认的用户ID  </span>
</span></span><span style="display:flex;"><span>    defaultLoginUser.<span style="color:#8caaee">setUsername</span>(Constants.<span style="color:#8caaee">DEMO_ACCOUNT</span>);  <span style="color:#737994;font-style:italic">// 设置默认的用户名  </span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    SysUser demoSysUser <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> SysUser();  
</span></span><span style="display:flex;"><span>    demoSysUser.<span style="color:#8caaee">setUserId</span>(173L);  
</span></span><span style="display:flex;"><span>    demoSysUser.<span style="color:#8caaee">setUserName</span>(Constants.<span style="color:#8caaee">DEMO_ACCOUNT</span>);  
</span></span><span style="display:flex;"><span>    demoSysUser.<span style="color:#8caaee">setDeptId</span>(100L);  
</span></span><span style="display:flex;"><span>    demoSysUser.<span style="color:#8caaee">setStatus</span>(<span style="color:#a6d189">&#34;0&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    defaultLoginUser.<span style="color:#8caaee">setUser</span>(demoSysUser);  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">// 设置其他必要的默认属性  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> defaultLoginUser;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//结束后清理用户信息, 防止线程复用导致内存泄露</span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">afterCompletion</span>(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">throws</span> Exception {  
</span></span><span style="display:flex;"><span>    SecurityContextHolder.<span style="color:#8caaee">remove</span>();  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f91a61b39377d9ea9caf33190d589187">12 - WebSocket</h1>
    <div class="lead">HTTP只能单向向服务器请求, 如果要实现服务器通知, 就必须由客户端轮询, 压力非常大. 并且HTTP会携带无效信息, 延迟很高
因此出现了WebSocket</div>
	<p>如果需要定期给浏览器推送数据，例如股票行情，或者不定期给浏览器推送数据，例如在线聊天，基于HTTP协议实现这类需求，只能依靠浏览器的JavaScript定时轮询，效率很低且实时性不高。</p>
<p>2009年出现的新技术<code>Websocket</code> 允许建立浏览器客户端和服务端之间的双向连接, 并且发送轻量级的数据模型, 服务端可以在需要时直接向客户端推送消息</p>
<p>不同于传统的<code>Http</code> ,<code>Websocket</code>  允许建立通路, 可以直接发送信息而不需像HTTP一样创建连接上下文, 原理如下</p>
<p>在建立TCP连接后, 附带几个请求头</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#8caaee">GET</span> <span style="color:#ef9f76">/chat</span> <span style="color:#ca9ee6">HTTP</span><span style="color:#99d1db;font-weight:bold">/</span><span style="color:#ef9f76">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#99d1db;font-weight:bold">:</span> www.example.com
</span></span><span style="display:flex;"><span>Upgrade<span style="color:#99d1db;font-weight:bold">:</span> websocket
</span></span><span style="display:flex;"><span>Connection<span style="color:#99d1db;font-weight:bold">:</span> Upgrade
</span></span></code></pre></div><p>此后连接升级为长连接</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>HTTP/1.1 101 Switching Protocols
</span></span><span style="display:flex;"><span>Upgrade: websocket
</span></span><span style="display:flex;"><span>Connection: Upgrade
</span></span></code></pre></div><p>收到成功响应后表示WebSocket“握手”成功，这样，代表WebSocket的这个TCP连接将不会被服务器关闭，而是一直保持，服务器可随时向浏览器推送消息，浏览器也可随时向服务器推送消息。双方推送的消息既可以是文本消息，也可以是二进制消息，一般来说，绝大部分应用程序会推送基于JSON的文本消息。</p>
<h4 id="使用-websocket">使用 Websocket<a class="td-heading-self-link" href="#%e4%bd%bf%e7%94%a8-websocket" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>开始前阅读 <a href="content/en/java/Advanced/_index.md">架构说明</a></p>
<p>建立新模块 <code>sample-ws</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">&lt;!-- ws --&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#ca9ee6">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">&lt;artifactId&gt;</span>spring-boot-starter-websocket<span style="color:#ca9ee6">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>启动类</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * 描述：程序启动入口  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> *  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @version 1.0.0  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span><span style="color:#8caaee;font-weight:bold">@SpringBootApplication</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableBinding</span>(Sink.<span style="color:#8caaee">class</span>)  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableDiscoveryClient</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">WsApplication</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) {  
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#8caaee">run</span>(WsApplication.<span style="color:#8caaee">class</span>, args);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>实现服务端和浏览器的双向通信, 我们要写一个服务器</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Component</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@ServerEndpoint</span>(<span style="color:#a6d189">&#34;/chat&#34;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">ChatServer</span> {
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * 保存连接对象, 连接池, 放用户session和key
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> */</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> ConcurrentHashMap<span style="color:#99d1db;font-weight:bold">&lt;</span>String, Session<span style="color:#99d1db;font-weight:bold">&gt;</span> SESSION_POOL <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> ConcurrentHashMap<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnOpen</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onOpen</span>(Session session) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnMessage</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> String <span style="color:#8caaee">onMessage</span>(String text, Session session) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnClose</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onClose</span>(Session session)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnError</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onError</span>(Session session, Throwable throwable)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>解释一下</p>
<ol>
<li>
<p>首先组件注解加上, Spring 会自动装载为组件</p>
</li>
<li>
<p>关于 <code>@ServerEndpoint</code>
WebSocket 是一种基于 TCP 的协议，它是持久化连接，通信过程中不会像 HTTP 请求那样每次都经过请求-响应的流程，因此不能直接通过传统的 Spring MVC 控制器方法来处理。</p>
<p><code>@ServerEndpoint</code> 是 WebSocket 规范中的一种标注方式，用来标识一个 WebSocket 服务器端点。当客户端连接到这个端点时，会自动调用这个类中的相应方法。</p>
<p>我们只需要知道服务器与 /server 绑定即可</p>
</li>
<li>
<p>我们在server中定义了四个方法, 启动时调用, 消息时调用, 关闭时调用, 错误时调用</p>
</li>
<li>
<p>我们创建一个链接池, 存放浏览器和服务器的长连接</p>
</li>
</ol>
<p>这个端点注解依赖一个配置类</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250223215044977.png" alt="image.png"></p>
<p>我们在 <code>ws.config</code> 下新建一个配置类 ,这是写死的, 不用理解</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @program: demo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @description: 服务端点配置  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author: hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> **/</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Configuration</span>  
</span></span><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@EnableWebSocket</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">WebSocketConfig</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Bean</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> ServerEndpointExporter <span style="color:#8caaee">serverEndpoint</span>() {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> <span style="color:#ca9ee6">new</span> ServerEndpointExporter();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>当浏览器首先试图建立与服务器的连接, 这里调用 <code>@OnOpen</code> 注解方法</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnOpen</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onOpen</span>(Session session) <span style="color:#e78284">throws</span> IOException {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//判断客户端对象是否存在  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//排除重复的连接对象  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (SESSION_POOL.<span style="color:#8caaee">containsKey</span>(session.<span style="color:#8caaee">getQueryString</span>())) {  
</span></span><span style="display:flex;"><span>        CloseReason reason <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> CloseReason(CloseReason.<span style="color:#8caaee">CloseCodes</span>.<span style="color:#8caaee">CANNOT_ACCEPT</span>, <span style="color:#a6d189">&#34;ID冲突，连接拒绝&#34;</span>);  
</span></span><span style="display:flex;"><span>        session.<span style="color:#8caaee">getUserProperties</span>().<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;reason&#34;</span>, reason);  
</span></span><span style="display:flex;"><span>        session.<span style="color:#8caaee">close</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//将客户端记录到Map中  </span>
</span></span><span style="display:flex;"><span>    SESSION_POOL.<span style="color:#8caaee">put</span>(session.<span style="color:#8caaee">getQueryString</span>(), session);  
</span></span><span style="display:flex;"><span>    System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;客户端（&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;）：开启连接&#34;</span>);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>解释一下, 浏览器会传入一个客户端ID, 服务器根据ID来提供服务</p>
<p>每个ID标识了长连接, 服务器根据ID提供服务</p>
<ol>
<li>传入连接后判断是否重复, 从连接池拿session里的key, 如果重复就拒绝连接</li>
<li>没有重复, 将Session保存到连接池(Map)里</li>
<li>控制套打印日志, 这里可以用slf4j</li>
</ol>
<blockquote>
<p>注意:
这里的<code>Session</code> 指的是长连接, 和 <code>HTTP Session</code> 不是一个东西</p></blockquote>
<p>之后长连接建立, 可以双向监听信息, 一旦服务器或者浏览器有信息了就调用 <code>@OnMessage</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnMessage</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> String <span style="color:#8caaee">onMessage</span>(String text, Session session) <span style="color:#e78284">throws</span> IOException {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//解析消息 =&gt; ID::消息内容  </span>
</span></span><span style="display:flex;"><span>    String<span style="color:#99d1db;font-weight:bold">[]</span> msgArr <span style="color:#99d1db;font-weight:bold">=</span> text.<span style="color:#8caaee">split</span>(<span style="color:#a6d189">&#34;::&#34;</span>, 2);  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//群发消息 ID=all表示群发  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (<span style="color:#a6d189">&#34;all&#34;</span>.<span style="color:#8caaee">equalsIgnoreCase</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>0<span style="color:#99d1db;font-weight:bold">]</span>)) {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">for</span> (Session one : SESSION_POOL.<span style="color:#8caaee">values</span>()) {  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//排除自己  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">if</span> (session <span style="color:#99d1db;font-weight:bold">==</span> one) {  
</span></span><span style="display:flex;"><span>                <span style="color:#ca9ee6">continue</span>;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//发送消息  </span>
</span></span><span style="display:flex;"><span>            one.<span style="color:#8caaee">getBasicRemote</span>().<span style="color:#8caaee">sendText</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">]</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//指定发送人, 不是all的情况  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">else</span> {  
</span></span><span style="display:flex;"><span>        Session target <span style="color:#99d1db;font-weight:bold">=</span> SESSION_POOL.<span style="color:#8caaee">get</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>0<span style="color:#99d1db;font-weight:bold">]</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (target <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>            target.<span style="color:#8caaee">getBasicRemote</span>().<span style="color:#8caaee">sendText</span>(msgArr<span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">]</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;:消息发送成功&#34;</span>;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>消息发送的方式有两种, 点对点和群发</p>
<p>点对点就找出目标Session, 服务器向Session写信息发送就行
群发就需要遍历连接池的每一个Session, 全部写信息</p>
<p>当然, 前提是排除发送者的Session</p>
<p>关闭连接, 也就是浏览器离线需要执行线程池移除线程的操作, 调用 <code>@OnClose</code> 方法
这里注意, webSocket并没有强制关闭连接的能力, 这是通知远程连接自主关闭, 服务器只负责监视是否关闭</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@OnClose</span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">onClose</span>(Session session) {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//处理拒绝连接session关闭对象, 不从池子里移除  </span>
</span></span><span style="display:flex;"><span>    Object obj <span style="color:#99d1db;font-weight:bold">=</span> session.<span style="color:#8caaee">getUserProperties</span>().<span style="color:#8caaee">get</span>(<span style="color:#a6d189">&#34;reason&#34;</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (obj <span style="color:#ca9ee6">instanceof</span> CloseReason) {  
</span></span><span style="display:flex;"><span>        CloseReason reason <span style="color:#99d1db;font-weight:bold">=</span> (CloseReason) obj;  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (reason.<span style="color:#8caaee">getCloseCode</span>() <span style="color:#99d1db;font-weight:bold">==</span> CloseReason.<span style="color:#8caaee">CloseCodes</span>.<span style="color:#8caaee">CANNOT_ACCEPT</span>) {  
</span></span><span style="display:flex;"><span>            System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;拒绝客户端（&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;）：关闭连接&#34;</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">return</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//将session对象从map中移除,正常关闭  </span>
</span></span><span style="display:flex;"><span>    SESSION_POOL.<span style="color:#8caaee">remove</span>(session.<span style="color:#8caaee">getQueryString</span>());  
</span></span><span style="display:flex;"><span>    System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;客户端（&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> session.<span style="color:#8caaee">getQueryString</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;）：关闭连接&#34;</span>);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>这是比较简单的应用不再考虑连接复用的问题</p></blockquote>
<p>接下来写浏览器页面</p>
<p>这里我们略过了~</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">&lt;!DOCTYPE html&gt;</span>  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">html</span> <span style="color:#8caaee">lang</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;en&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">head</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">meta</span> <span style="color:#8caaee">charset</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;UTF-8&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">title</span>&gt;聊天室客户端&lt;/<span style="color:#ca9ee6">title</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">head</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">body</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">h1</span>&gt;Chat Client&lt;/<span style="color:#ca9ee6">h1</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">div</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;clientId&#34;</span> <span style="color:#8caaee">placeholder</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;输入ID&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;1&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">onclick</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;init()&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;连接服务器&#34;</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;button&#34;</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;receiverId&#34;</span> <span style="color:#8caaee">placeholder</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;输入接收人ID&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;all&#34;</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">textarea</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;message&#34;</span> <span style="color:#8caaee">style</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;margin: 0; height: 197px; width: 362px;&#34;</span>  
</span></span><span style="display:flex;"><span>              <span style="color:#8caaee">placeholder</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;发送消息内容&#34;</span>&gt;&lt;/<span style="color:#ca9ee6">textarea</span>&gt;&lt;<span style="color:#ca9ee6">br</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">onclick</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;send()&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;发送消息&#34;</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;button&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ca9ee6">input</span> <span style="color:#8caaee">onclick</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;closeConnect()&#34;</span> <span style="color:#8caaee">value</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;关闭连接&#34;</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;button&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">div</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">div</span> <span style="color:#8caaee">id</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;output&#34;</span>&gt;&lt;/<span style="color:#ca9ee6">div</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;<span style="color:#ca9ee6">script</span> <span style="color:#8caaee">type</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;text/javascript&#34;</span> <span style="color:#8caaee">language</span><span style="color:#99d1db;font-weight:bold">=</span><span style="color:#a6d189">&#34;JavaScript&#34;</span>&gt;  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//屏幕回显输出方法  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">function</span> writeToScreen(message) {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> pre <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.createElement(<span style="color:#a6d189">&#34;p&#34;</span>);  
</span></span><span style="display:flex;"><span>        pre.style.wordWrap <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;break-word&#34;</span>;  
</span></span><span style="display:flex;"><span>        pre.innerHTML <span style="color:#99d1db;font-weight:bold">=</span> message;  
</span></span><span style="display:flex;"><span>        <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;output&#34;</span>).appendChild(pre);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//初始化websocket  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">let</span> echo_websocket;  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">function</span> init() {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> clientId <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;clientId&#34;</span>).value;  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">/* 这里端口是写死的 */</span>        <span style="color:#e78284">let</span> wsUri <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;ws://localhost:10800/chat?&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> clientId;  
</span></span><span style="display:flex;"><span>        writeToScreen(<span style="color:#a6d189">&#34;连接到&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> wsUri);  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//1.创建WebSocket客户端对象  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> WebSocket(wsUri);  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//2.开门握手完成回调  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onopen <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span> (evt) {  
</span></span><span style="display:flex;"><span>            console.log(evt);  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#34;连接打开成功 !&#34;</span>);  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//3.监听服务端的消息  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onmessage <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span> (evt) {  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#34;接收服务端消息:&lt;br&gt; &#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> evt.data);  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//4.如果连接中断  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onerror <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span> (evt) {  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#39;&lt;span style=&#34;color: red;&#34;&gt;ERROR:&#39;</span><span style="color:#99d1db;font-weight:bold">+</span>evt.data<span style="color:#99d1db;font-weight:bold">+</span><span style="color:#a6d189">&#39;&lt;/span&gt;&#39;</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>            closeConnect();  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//5.注册close事件  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>        echo_websocket.onclose <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e78284">function</span>(evt){  
</span></span><span style="display:flex;"><span>            writeToScreen(<span style="color:#a6d189">&#39;&lt;span style=&#34;color: green;&#34;&gt;INFO：关闭连接&lt;/span&gt; &#39;</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">if</span>(evt.reason){  
</span></span><span style="display:flex;"><span>                writeToScreen  
</span></span><span style="display:flex;"><span>                (<span style="color:#a6d189">`&lt;span style=&#34;color: red;&#34;&gt;错误信息：</span><span style="color:#a6d189">${</span>evt.reason<span style="color:#a6d189">}</span><span style="color:#a6d189">&lt;/span&gt; `</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//6.向服务发送消息  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">function</span> send() {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> message <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;message&#34;</span>).value;  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">let</span> receiver <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db">document</span>.getElementById(<span style="color:#a6d189">&#34;receiverId&#34;</span>).value;  
</span></span><span style="display:flex;"><span>        echo_websocket.send(receiver <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;::&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> message);  
</span></span><span style="display:flex;"><span>        writeToScreen(<span style="color:#a6d189">&#34;发送消息: &#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> message);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//7.如果不需要通讯，那么关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>    <span style="color:#e78284">function</span> closeConnect() {  
</span></span><span style="display:flex;"><span>        echo_websocket.close();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">script</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">body</span>&gt;  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ca9ee6">html</span>&gt;
</span></span></code></pre></div><p>我们需要解释下构建/发送信息的代码</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>//6.向服务发送消息  
</span></span><span style="display:flex;"><span>    function send() {  
</span></span><span style="display:flex;"><span>        let message = document.getElementById(&#34;message&#34;).value;  
</span></span><span style="display:flex;"><span>        let receiver = document.getElementById(&#34;receiverId&#34;).value;  
</span></span><span style="display:flex;"><span>        echo_websocket.send(receiver + &#34;::&#34; + message);  
</span></span><span style="display:flex;"><span>        writeToScreen(&#34;发送消息: &#34; + message);  
</span></span><span style="display:flex;"><span>    } 
</span></span></code></pre></div><p>这里拿到表单组件, 取值后通过 <code>::</code> 拼接为消息, 链接符之前为id, 之后为消息</p>
<p>其中初始化的 <code>echo_websocket</code> 组件是dom库提供的 <code>echo_websocket = new WebSocket(wsUri);</code> , 除了IE其他浏览器都支持</p>
<p>在前端打开三个浏览器页面, 作为三个客户端</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250223215339746.png" alt="image.png"></p>
<p>注意id要不同</p>
<p>后台运行服务器, 就可以开始监听了</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7a2c40656558a17fe41d7952d03dfa64">13 - 事务管理</h1>
    
	<h4 id="事务是什么">事务是什么?<a class="td-heading-self-link" href="#%e4%ba%8b%e5%8a%a1%e6%98%af%e4%bb%80%e4%b9%88" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>一组操作, 要么全部执行, 要么全部失败, 把非原子操作封装为原子操作的概念</p>
<p>还是老生长谈的原子性问题</p>
<blockquote>
<p><a href="%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98.md#%E5%8E%9F%E5%AD%90%E6%80%A7%E9%97%AE%E9%A2%98">原子性问题</a></p></blockquote>
<h4 id="事务的特性">事务的特性<a class="td-heading-self-link" href="#%e4%ba%8b%e5%8a%a1%e7%9a%84%e7%89%b9%e6%80%a7" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>ACID</p>
<p>原子性: 事务是最小的执行单位, 不允许分割. 事务的原子性确保动作要么全部完成, 要么不起作用</p>
<p>隔离性: 一个用户的事务不能被其他用户干扰, 并发事务之间的数据库独立</p>
<p>持久性: 事务提交后, 数据库改变时持久的, 即使发生故障也不能有任何影响</p>
<p>最终目的: 一致性: 事务前的数据一致, 事务后的数据一致</p>
<p>原子性，隔离性和持久性是数据库的属性，而一致性（在 ACID 意义上）是应用程序的属性</p>
<h4 id="mysql如何保证事务的原子性的">MySQL如何保证事务的原子性的?<a class="td-heading-self-link" href="#mysql%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e4%ba%8b%e5%8a%a1%e7%9a%84%e5%8e%9f%e5%ad%90%e6%80%a7%e7%9a%84" aria-label="Heading self-link"></a></h4>
<meta name="baidu-site-verification" content="codeva-23xblvQ4Jb" /><p>所有事务操作都会记录到回滚操作日志, 一旦异常发生就会根据日志进行数据回滚
回滚日志的优先级高于数据持久化, 也就是说数据库宕机导致数据没能完整写到磁盘上, 再次开机可以根据回滚日志回滚未完成的事务</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ca8521f6a11893682100c677a8e28283">14 - 响应式编程Reactor库</h1>
    
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7f81b67460689b745ab9bb3e9564c653">15 - 声明式服务</h1>
    
	
</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://example.org/twitter" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Stack Overflow" aria-label="Stack Overflow">
    <a target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/hamhuo-hub/seaku" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Developer mailing list" aria-label="Developer mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025&ndash;2025
    <span class="td-footer__authors">海阔知识库 | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.f72d00502781aaf278a14088eb2356b1ba2a05ad698a0c43fe86314d74ceab56.js" integrity="sha256-9y0AUCeBqvJ4oUCI6yNWsboqBa1pigxD/oYxTXTOq1Y=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
