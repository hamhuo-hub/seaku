<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>并发编程 | 海阔集</title>
<meta name="description" content="面试-并发编程">
<meta property="og:url" content="http://localhost:1313/interview/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">
  <meta property="og:site_name" content="海阔集">
  <meta property="og:title" content="并发编程">
  <meta property="og:description" content="面试-并发编程">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="interview">
    <meta property="article:tag" content="并发编程">

  <meta itemprop="name" content="并发编程">
  <meta itemprop="description" content="面试-并发编程">
  <meta itemprop="wordCount" content="979">
  <meta itemprop="keywords" content="并发编程">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="并发编程">
  <meta name="twitter:description" content="面试-并发编程">
<link href="/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-page">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="800" height="800" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23.3 8.40007 21.82 6.40008C21.7248 6.27314 21.6008 6.17066 21.4583 6.10111 21.3157 6.03156 21.1586 5.99693 21 6.00008H11.2C11.0555 6.00007 10.9128 6.03135 10.7816 6.09177 10.6504 6.15219 10.5339 6.24031 10.44 6.35007L8.71998 8.35008C8.57227 8.53401 8.49435 8.76424 8.49998 9.00008V16.2901C8.50262 18.0317 9.19567 19.7013 10.4272 20.9328c1.2316 1.2316 2.9011 1.9246 4.6428 1.9273h1.86C18.6716 22.8574 20.3412 22.1644 21.5728 20.9328c1.2315-1.2315 1.9245-2.9011 1.9272-4.6427V9.00008C23.5 8.7837 23.4298 8.57317 23.3 8.40007z" fill="#ffcc80"/><path d="M29.78 28.38l-4-5C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38z" fill="#01579b"/><path d="M29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344L15.73 11.6C15.906 11.6534 16.094 11.6534 16.27 11.6l13-3.59997C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003z" fill="#01579b"/><path d="M11.22 6C11.0756 5.99999 10.9328 6.03127 10.8016 6.09169 10.6704 6.15211 10.5539 6.24023 10.46 6.35l-1.72 2C8.58509 8.53114 8.49998 8.76166 8.5 9v7.29C8.50264 18.0317 9.19569 19.7012 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272H16V6H11.22z" fill="#ffe0b2"/><path d="M7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H16V25L7.21999 23z" fill="#0277bd"/><path d="M15.71 2.00002l-13 4C2.49742 6.06422 2.31226 6.19734 2.1837 6.3784c-.12855.18107-.19318.39977-.1837.62162C1.9917 7.22447 2.0592 7.44518 2.19163 7.62658 2.32405 7.80799 2.5137 7.93954 2.73 8.00002L15.73 11.6C15.8194 11.6146 15.9106 11.6146 16 11.6V2.00002C15.9039 1.98469 15.8061 1.98469 15.71 2.00002z" fill="#0277bd"/><path d="M2.73 8.00003l5.77 1.56V16.29C8.50264 18.0317 9.19569 19.7013 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272h1.86C18.6717 22.8574 20.3412 22.1643 21.5728 20.9328c1.2315-1.2315 1.9246-2.9011 1.9272-4.6428V9.56003l5.77-1.56C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344zM21.5 16.29C21.4974 17.5013 21.015 18.6621 20.1586 19.5186 19.3021 20.3751 18.1412 20.8574 16.93 20.86H15.07C13.8588 20.8574 12.6979 20.3751 11.8414 19.5186 10.985 18.6621 10.5026 17.5013 10.5 16.29V10.11l5.23 1.45C15.906 11.6134 16.094 11.6134 16.27 11.56l5.23-1.45v6.18zM16 4.05003l9.44 2.95-9.44 2.56-9.44-2.56 9.44-2.95z" fill="#263238"/><path d="M25.78 23.38C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38l-4-5zM5.07999 28l2.31-2.89L15.78 27C15.9251 27.0299 16.0748 27.0299 16.22 27l8.39-1.87L26.92 28H5.07999z" fill="#263238"/></svg></span><span class="navbar-brand__name">海阔集</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/leetcode/"><span>Alog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/docs/"><span>Doc</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/interview/"><span>Interview</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="td-sidebar-nav collapse" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-interview-li">
  <a href="/interview/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-interview"><span class="">Interview</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-interviewe5b9b6e58f91e7bc96e7a88b-li">
  <a href="/interview/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id="m-interviewe5b9b6e58f91e7bc96e7a88b"><span class="td-sidebar-nav-active-item">并发编程</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/google/docsy-example/tree/main/C:%5cUsers%5chamhuo%5cDocuments%5cGitHub%5cseaku%5ccontent%5cen%5cinterview%5c%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/google/docsy-example/edit/main/C:%5cUsers%5chamhuo%5cDocuments%5cGitHub%5cseaku%5ccontent%5cen%5cinterview%5c%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/google/docsy-example/new/main/C:/Users/hamhuo/Documents/GitHub/seaku/content/en/interview?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/google/docsy-example/issues/new?title=%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/google/docsy/issues/new" class="td-page-meta--project td-page-meta__project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
  <a id="print" href="/interview/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
        <li><a href="#你在工作中用到过-threadlocal-吗">你在工作中用到过 ThreadLocal 吗？</a></li>
        <li><a href="#threadlocal-怎么实现的呢">ThreadLocal 怎么实现的呢?</a></li>
        <li><a href="#threadlocalmap-的源码看过吗"><code>ThreadLocalMap</code> 的源码看过吗？</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    
            <div class="taxonomy taxonomy-terms-cloud taxo-tags">
      <h5 class="taxonomy-title">Tag Cloud</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/docker/" data-taxonomy-term="docker"><span class="taxonomy-label">Docker</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/gc/" data-taxonomy-term="gc"><span class="taxonomy-label">GC</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/jvm/" data-taxonomy-term="jvm"><span class="taxonomy-label">JVM</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/list/" data-taxonomy-term="list"><span class="taxonomy-label">List</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/mysql/" data-taxonomy-term="mysql"><span class="taxonomy-label">MySQL</span><span class="taxonomy-count">6</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/redis/" data-taxonomy-term="redis"><span class="taxonomy-label">Redis</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E5%88%86%E6%B2%BB/" data-taxonomy-term="%E5%88%86%E6%B2%BB"><span class="taxonomy-label">分治</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E5%8F%8C%E6%8C%87%E9%92%88/" data-taxonomy-term="%E5%8F%8C%E6%8C%87%E9%92%88"><span class="taxonomy-label">双指针</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" data-taxonomy-term="%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="taxonomy-label">字符串</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" data-taxonomy-term="%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="taxonomy-label">并发编程</span><span class="taxonomy-count">17</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" data-taxonomy-term="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="taxonomy-label">操作系统</span><span class="taxonomy-count">7</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" data-taxonomy-term="%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="taxonomy-label">消息队列</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E7%9F%A9%E9%98%B5/" data-taxonomy-term="%E7%9F%A9%E9%98%B5"><span class="taxonomy-label">矩阵</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E9%80%92%E5%BD%92/" data-taxonomy-term="%E9%80%92%E5%BD%92"><span class="taxonomy-label">递归</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E9%80%9A%E9%85%8D%E7%AC%A6/" data-taxonomy-term="%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="taxonomy-label">通配符</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E9%93%BE%E8%A1%A8/" data-taxonomy-term="%E9%93%BE%E8%A1%A8"><span class="taxonomy-label">链表</span><span class="taxonomy-count">10</span></a></li>
        </ul>
    </div>
  <div class="taxonomy taxonomy-terms-cloud taxo-categories">
      <h5 class="taxonomy-title">Categories</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="http://localhost:1313/categories/java%E5%9F%BA%E7%A1%80%E8%83%BD%E5%8A%9B/" data-taxonomy-term="java%E5%9F%BA%E7%A1%80%E8%83%BD%E5%8A%9B"><span class="taxonomy-label">Java基础能力</span><span class="taxonomy-count">25</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/categories/java%E8%BF%9B%E9%98%B6%E8%83%BD%E5%8A%9B/" data-taxonomy-term="java%E8%BF%9B%E9%98%B6%E8%83%BD%E5%8A%9B"><span class="taxonomy-label">Java进阶能力</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/categories/java%E9%9D%A2%E8%AF%95/" data-taxonomy-term="java%E9%9D%A2%E8%AF%95"><span class="taxonomy-label">Java面试</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/categories/%E7%AE%97%E6%B3%95/" data-taxonomy-term="%E7%AE%97%E6%B3%95"><span class="taxonomy-label">算法</span><span class="taxonomy-count">10</span></a></li>
        <li><a class="taxonomy-term" href="http://localhost:1313/categories/%E9%80%9A%E7%94%A8%E8%83%BD%E5%8A%9B/" data-taxonomy-term="%E9%80%9A%E7%94%A8%E8%83%BD%E5%8A%9B"><span class="taxonomy-label">通用能力</span><span class="taxonomy-count">5</span></a></li>
        </ul>
    </div>
  
	
          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/interview/">Interview</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    并发编程</li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>并发编程</h1>
	<div class="lead">面试-并发编程</div>
	<header class="article-meta">
		<div class="taxonomy taxonomy-terms-article taxo-tags">
  <h5 class="taxonomy-title">Tags:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="http://localhost:1313/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" data-taxonomy-term="%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="taxonomy-label">并发编程</span></a></li>
    </ul>
</div>
<div class="taxonomy taxonomy-terms-article taxo-categories">
  <h5 class="taxonomy-title">Categories:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="http://localhost:1313/categories/java%E9%9D%A2%E8%AF%95/" data-taxonomy-term="java%E9%9D%A2%E8%AF%95"><span class="taxonomy-label">Java面试</span></a></li>
    </ul>
</div>

  </header>
	<h4 id="并行和并发的区别">并行和并发的区别<a class="td-heading-self-link" href="#%e5%b9%b6%e8%a1%8c%e5%92%8c%e5%b9%b6%e5%8f%91%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="Heading self-link"></a></h4>
<p>处理器同时处理多个任务为并行
处理器在一定的时间间隔, 交替处理任务交并发</p>
<p>类似红绿灯, 路口所有车道车辆通信为并行
但是路口一定时间间隔内只允许一辆车通过, 不同车道的车交替通过叫并发</p>
<h4 id="什么是线程安全">什么是线程安全<a class="td-heading-self-link" href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>2/5/2025</p></blockquote>
<p>线程安全是指,  多线程环境下访问共享资源时, 线程可以正确执行, 而不会出现问题</p>
<p>线程安全有以下几个问题</p>
<p>可见性问题
线程对共享变量的修改能被其他线程立即看到
可以通过 volatile 关键字保证数据一致性</p>
<p>原子性问题
操作是不可分割的, 成功则全部成功, 失败则全部失败
原子性可以通过正确的同步机制 如 syncroizd 关键字实现线程同步以及原子操作来保证, 防止操作被意外中断</p>
<p>活跃性问题
当多线程争夺有限资源时可能会导致死锁, 饥饿等问题</p>
<h4 id="如何保证线程安全">如何保证线程安全<a class="td-heading-self-link" href="#%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>2/9</p></blockquote>
<p>为了保证线程安全，可以使用 synchronized 关键字或 ReentrantLock 来保证共享资源的互斥访问。</p>
<p>对于简单的变量操作，可以使用 Atomic 类来实现无锁线程安全。</p>
<p>可以使用线程安全容器，如 ConcurrentHashMap 或 CopyOnWriteArrayList。</p>
<p>对于每个线程独立的数据，可以使用 ThreadLocal 来为每个线程提供独立的变量副本。</p>
<p>对于简单的状态标志，可以使用 volatile 关键字确保多线程间的可见性。</p>
<h4 id="有个int的变量为0十个线程轮流对其进行操作循环10000次结果是大于小于还是等于10万为什么">有个int的变量为0，十个线程轮流对其进行++操作（循环10000次），结果是大于小于还是等于10万，为什么？<a class="td-heading-self-link" href="#%e6%9c%89%e4%b8%aaint%e7%9a%84%e5%8f%98%e9%87%8f%e4%b8%ba0%e5%8d%81%e4%b8%aa%e7%ba%bf%e7%a8%8b%e8%bd%ae%e6%b5%81%e5%af%b9%e5%85%b6%e8%bf%9b%e8%a1%8c%e6%93%8d%e4%bd%9c%e5%be%aa%e7%8e%af10000%e6%ac%a1%e7%bb%93%e6%9e%9c%e6%98%af%e5%a4%a7%e4%ba%8e%e5%b0%8f%e4%ba%8e%e8%bf%98%e6%98%af%e7%ad%89%e4%ba%8e10%e4%b8%87%e4%b8%ba%e4%bb%80%e4%b9%88" aria-label="Heading self-link"></a></h4>
<p>小于</p>
<p>int++ 实际上可以分解为三步：</p>
<ol>
<li>读取变量的值。</li>
<li>将读取到的值加 1。</li>
<li>将结果写回变量。</li>
</ol>
<p>多线程并发操作共享的i 会出现竞态条件</p>
<ul>
<li>线程 1 读取变量值为 0。</li>
<li>线程 2 也读取变量值为 0。</li>
<li>线程 1 进行加法运算并将结果 1 写回变量。</li>
<li>线程 2 进行加法运算并将结果 1 写回变量，覆盖了线程 1 的结果。</li>
</ul>
<h4 id="场景有一个-key-对应的-value-是一个json-结构json-当中有好几个子任务这些子任务如果对-key-进行修改的话会不会存在线程安全的问题如何解决如果是多个节点的情况应该怎么加锁">场景:有一个 key 对应的 value 是一个json 结构，json 当中有好几个子任务，这些子任务如果对 key 进行修改的话,会不会存在线程安全的问题?如何解决?如果是多个节点的情况，应该怎么加锁?<a class="td-heading-self-link" href="#%e5%9c%ba%e6%99%af%e6%9c%89%e4%b8%80%e4%b8%aa-key-%e5%af%b9%e5%ba%94%e7%9a%84-value-%e6%98%af%e4%b8%80%e4%b8%aajson-%e7%bb%93%e6%9e%84json-%e5%bd%93%e4%b8%ad%e6%9c%89%e5%a5%bd%e5%87%a0%e4%b8%aa%e5%ad%90%e4%bb%bb%e5%8a%a1%e8%bf%99%e4%ba%9b%e5%ad%90%e4%bb%bb%e5%8a%a1%e5%a6%82%e6%9e%9c%e5%af%b9-key-%e8%bf%9b%e8%a1%8c%e4%bf%ae%e6%94%b9%e7%9a%84%e8%af%9d%e4%bc%9a%e4%b8%8d%e4%bc%9a%e5%ad%98%e5%9c%a8%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e7%9a%84%e9%97%ae%e9%a2%98%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e5%a6%82%e6%9e%9c%e6%98%af%e5%a4%9a%e4%b8%aa%e8%8a%82%e7%82%b9%e7%9a%84%e6%83%85%e5%86%b5%e5%ba%94%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%a0%e9%94%81" aria-label="Heading self-link"></a></h4>
<p>会</p>
<p>单机环境下, 也就是单节点
可以通过 syncroized 或者ReentranLock 实现线程互斥读写</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @program: alog  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @description: 多线程修改key  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author: hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> **/</span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">keyAndJson</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//使用重入锁正确互斥  </span>
</span></span><span style="display:flex;"><span>    ReentrantLock lock <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> ReentrantLock();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> String key <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;{\&#34;tasks\&#34;: [\&#34;task1\&#34;, \&#34;task2\&#34;]}&#34;</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//线程读方法  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> String <span style="color:#8caaee">readJson</span>() {  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//上锁, 互斥读  </span>
</span></span><span style="display:flex;"><span>        lock.<span style="color:#8caaee">lock</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">try</span>{  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">return</span> key.<span style="color:#8caaee">trim</span>();  
</span></span><span style="display:flex;"><span>        }<span style="color:#ca9ee6">catch</span>(Exception e){  
</span></span><span style="display:flex;"><span>            e.<span style="color:#8caaee">printStackTrace</span>();  
</span></span><span style="display:flex;"><span>        }<span style="color:#ca9ee6">finally</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//finally解锁  </span>
</span></span><span style="display:flex;"><span>            lock.<span style="color:#8caaee">unlock</span>();  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> <span style="color:#ef9f76">null</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//线程写方法  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">writeJson</span>(String json) {  
</span></span><span style="display:flex;"><span>        lock.<span style="color:#8caaee">lock</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">try</span>{  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">this</span>.<span style="color:#8caaee">key</span> <span style="color:#99d1db;font-weight:bold">=</span> json;  
</span></span><span style="display:flex;"><span>        }<span style="color:#ca9ee6">catch</span>(Exception e){  
</span></span><span style="display:flex;"><span>            e.<span style="color:#8caaee">printStackTrace</span>();  
</span></span><span style="display:flex;"><span>        }<span style="color:#ca9ee6">finally</span> {  
</span></span><span style="display:flex;"><span>            lock.<span style="color:#8caaee">unlock</span>();  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>多节点下, 需要使用分布式锁 Redisson 来保证对 key 的修改操作是原子的
//todo redis</p>
<h4 id="讲一个线程安全的场景">讲一个线程安全的场景<a class="td-heading-self-link" href="#%e8%ae%b2%e4%b8%80%e4%b8%aa%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e7%9a%84%e5%9c%ba%e6%99%af" aria-label="Heading self-link"></a></h4>
<p>实现单例模式时需要确保线程安全</p>
<p>单例模式确保一个类只有一个实例，并提供一个全局访问点。在多线程环境下，如果多个线程同时尝试创建实例，单例类必须确保只创建一个实例。</p>
<p>饿汉式通过在类加载时初始化一个静态实例保证线程安全</p>
<p>懒汉式通过双重检查实现线程安全</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">singleton</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">volatile</span> singleton instance;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> <span style="color:#8caaee">singleton</span>() {};  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> singleton <span style="color:#8caaee">getInstance</span>() {  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//双重锁定  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//第一重, 检查是否实例已经生成, 这里允许多线程异步访问  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">if</span> (instance <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>            <span style="color:#e78284">synchronized</span> (singleton.<span style="color:#8caaee">class</span>) {  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//单线程环境  </span>
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//第二重, 目的是生成实例时确保只有一个线程生成  </span>
</span></span><span style="display:flex;"><span>                <span style="color:#ca9ee6">if</span> (instance <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>                    instance <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> singleton();  
</span></span><span style="display:flex;"><span>                    <span style="color:#ca9ee6">return</span> instance;  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> instance;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>当然, 直接使用枚举返回单例最合适, **因为<strong><strong>Java</strong></strong>虚拟机会保证枚举对象的唯一性，因此每一个枚举类型和定义的枚举变量在<strong><strong>JVM</strong></strong>中都是唯一的</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">enum</span> Singleton {
</span></span><span style="display:flex;"><span>     INSTANCE;
</span></span><span style="display:flex;"><span>     <span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">businessMethod</span>() {
</span></span><span style="display:flex;"><span>          System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;我是一个单例！&#34;</span>);
</span></span><span style="display:flex;"><span>     }
</span></span></code></pre></div><h4 id="什么是进程和线程">什么是进程和线程<a class="td-heading-self-link" href="#%e4%bb%80%e4%b9%88%e6%98%af%e8%bf%9b%e7%a8%8b%e5%92%8c%e7%ba%bf%e7%a8%8b" aria-label="Heading self-link"></a></h4>
<p>进程是程序的一次执行, 是系统分配资源的基本单位,
线程是进程的子任务, 是系统调度的基本单位</p>
<p>多个线程可以同一个进程的共享资源如内存, 每个线程有自己的栈和寄存器</p>
<h4 id="线程的共享内存是什么">线程的共享内存是什么<a class="td-heading-self-link" href="#%e7%ba%bf%e7%a8%8b%e7%9a%84%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98%e6%98%af%e4%bb%80%e4%b9%88" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>2/5/2025</p></blockquote>
<p>在Java中共享内存是Java线程通信的一种方式, 允许线程之间传递数据
Java的共享内存模型也叫JMM, JMM决定了线程对共享变量的写何时对其他线程可见共享变量存储在主存储中, 线程内部有该变量的副本
线程之间的通信必须先让一个线程刷新共享变量, 之后JMM同步另一个线程的副本</p>
<blockquote>
<p>引用:
<a href="https://cloud.baidu.com/article/3075183">https://cloud.baidu.com/article/3075183</a></p></blockquote>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的字节跳动商业化一面的原题：进程和线程区别，线程共享内存和进程共享内存的区别</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的小米春招同学 K 一面面试原题：协程和线程和进程的区别</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的字节跳动面经同学 1 Java 后端技术一面面试原题：线程和进程有什么区别？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的华为 OD 面经同学 1 一面面试原题：对于多线程编程的了解?</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的美团面经同学 2 Java 后端技术一面面试原题：进程和线程的区别？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的华为面经同学 9 Java 通用软件开发一面面试原题：进程和线程的区别</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的 小公司面经合集好未来测开面经同学 3 测开一面面试原题：进程和线程的区别</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的招商银行面经同学 6 招银网络科技面试原题：进程和线程的区别？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的用友面试原题：线程和进程的区别</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的vivo 面经同学 10 技术一面面试原题：线程的概念，线程有哪些状态</li>
</ol></blockquote>
<h4 id="线程的创建方式">线程的创建方式<a class="td-heading-self-link" href="#%e7%ba%bf%e7%a8%8b%e7%9a%84%e5%88%9b%e5%bb%ba%e6%96%b9%e5%bc%8f" aria-label="Heading self-link"></a></h4>
<p>继承Thread类, 重写run方法, 调用 start()启动线程
实现Runnable接口, 重写run方法, 创建 Thread对象并传入Runnable任务对象, 调用 start() 启动线程
实现Callable&lt;&gt;接口, 重写call方法, 新建 FutureTask 类打包任务, 创建 Thread对象并传入FutureTask任务对象, 调用start()启动线程</p>
<p>前两中线程执行没有返回值, 第三中可以获取执行结果</p>
<h4 id="启动一个java程序里面有哪些线程">启动一个Java程序里面有哪些线程?<a class="td-heading-self-link" href="#%e5%90%af%e5%8a%a8%e4%b8%80%e4%b8%aajava%e7%a8%8b%e5%ba%8f%e9%87%8c%e9%9d%a2%e6%9c%89%e5%93%aa%e4%ba%9b%e7%ba%bf%e7%a8%8b" aria-label="Heading self-link"></a></h4>
<p>main线程
垃圾回收守护线程
JIT及时编译线程</p>
<p>可以通过下列代码追踪</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">class</span> <span style="color:#e5c890">ThreadLister</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">// 获取所有线程的堆栈跟踪</span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#99d1db;font-weight:bold">&lt;</span>Thread, StackTraceElement<span style="color:#99d1db;font-weight:bold">[]&gt;</span> threads <span style="color:#99d1db;font-weight:bold">=</span> Thread.<span style="color:#8caaee">getAllStackTraces</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">for</span> (Thread thread : threads.<span style="color:#8caaee">keySet</span>()) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;Thread: &#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> thread.<span style="color:#8caaee">getName</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34; (ID=&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> thread.<span style="color:#8caaee">getId</span>() <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;)&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的字节跳动面经同学 1 Java 后端技术一面面试原题：有多少种实现线程的方法？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的农业银行同学 1 面试原题：实现线程的方式和区别</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的农业银行面经同学 3 Java 后端面试原题：说说线程的创建方法</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的小公司面经合集同学 1 Java 后端面试原题：线程创建的方式？Runable 和 Callable 有什么区别？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的阿里面经同学 5 阿里妈妈 Java 后端技术一面面试原题：一个 8G 内存的系统最多能创建多少线程?（奇怪的问题，答了一些 pcb、页表、虚拟机栈什么的）启动一个 Java 程序，你能说说里面有哪些线程吗？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的招商银行面经同学 6 招银网络科技面试原题：如何创建线程？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的百度面经同学 1 文心一言 25 实习 Java 后端面试原题：java 如何创建线程？每次都要创建新线程来实现异步操作，很繁琐，有了解线程池吗？</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java 面试指南（付费）</a>收录的美团面经同学 4 一面面试原题：平时怎么使用多线程</li>
</ol></blockquote>
<h4 id="调用-start-方法会执行-run-为什么不直接执行-run">调用 start() 方法会执行 run(), 为什么不直接执行 run()<a class="td-heading-self-link" href="#%e8%b0%83%e7%94%a8-start-%e6%96%b9%e6%b3%95%e4%bc%9a%e6%89%a7%e8%a1%8c-run-%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e7%9b%b4%e6%8e%a5%e6%89%a7%e8%a1%8c-run" aria-label="Heading self-link"></a></h4>
<p>直接调用run()方法会按照普通方法执行, 也就是在当前进程执行不会创建新的线程
start() 方法创建新线程后会在新线程调用run()实现多线程</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">class</span> <span style="color:#e5c890">MyThread</span> extend Thread{
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">run</span>(){
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="线程共有几种状态">线程共有几种状态?<a class="td-heading-self-link" href="#%e7%ba%bf%e7%a8%8b%e5%85%b1%e6%9c%89%e5%87%a0%e7%a7%8d%e7%8a%b6%e6%80%81" aria-label="Heading self-link"></a></h4>
<p>线程共有6种状态</p>
<p>NEW, RUANNABLE, WAIT, TIMED_WAIT, BLOCK, TERMINATE</p>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250208162007896.png" alt="image.png"></p>
<p>如何强制终止进程?</p>
<p>调用 <code>interrupt()</code> 方法, 设置中断标志, 通知线程中断</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">class</span> <span style="color:#e5c890">MyTask</span> <span style="color:#e78284">implements</span> Runnable {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">run</span>(){  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">while</span> (<span style="color:#99d1db;font-weight:bold">!</span>Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">isInterrupted</span>()) {  
</span></span><span style="display:flex;"><span>                System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;running&#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">getName</span>());  
</span></span><span style="display:flex;"><span>                <span style="color:#ca9ee6">try</span> {  
</span></span><span style="display:flex;"><span>                    <span style="color:#737994;font-style:italic">//线程睡1秒, 防止控制台滚动过快, 看不到效果  </span>
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#8caaee">sleep</span>(1000);  
</span></span><span style="display:flex;"><span>                }<span style="color:#ca9ee6">catch</span>(InterruptedException E){  
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>                    System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;Thread interrupted, exiting...&#34;</span>);  
</span></span><span style="display:flex;"><span>                    <span style="color:#ca9ee6">break</span>;  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">class</span> <span style="color:#e5c890">Main</span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) <span style="color:#e78284">throws</span> InterruptedException{  
</span></span><span style="display:flex;"><span>        MyTask task <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> MyTask();  
</span></span><span style="display:flex;"><span>        Thread t1 <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Thread(task);  
</span></span><span style="display:flex;"><span>        Thread t2 <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Thread(task);  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//启动线程  </span>
</span></span><span style="display:flex;"><span>        t1.<span style="color:#8caaee">start</span>();  
</span></span><span style="display:flex;"><span>        t2.<span style="color:#8caaee">start</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//主线程休眠3秒. 保证线程正常启动, 防止t1刚被启动就终止没有效果  </span>
</span></span><span style="display:flex;"><span>        Thread.<span style="color:#8caaee">sleep</span>(3000);  
</span></span><span style="display:flex;"><span>        t1.<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="线程上下文切换">线程上下文切换?<a class="td-heading-self-link" href="#%e7%ba%bf%e7%a8%8b%e4%b8%8a%e4%b8%8b%e6%96%87%e5%88%87%e6%8d%a2" aria-label="Heading self-link"></a></h4>
<p>多线程的目的是充分利用CPU资源
但是并发环境下单线程的CPU一段时间内线程是逐个执行的</p>
<p>CPU会将时间片分给占用的线程, 当时间片用完, CPU就轮转到下一个线程, 这就是上下文切换</p>
<h4 id="线程可以多核调度吗">线程可以多核调度吗<a class="td-heading-self-link" href="#%e7%ba%bf%e7%a8%8b%e5%8f%af%e4%bb%a5%e5%a4%9a%e6%a0%b8%e8%b0%83%e5%ba%a6%e5%90%97" aria-label="Heading self-link"></a></h4>
<p>可以</p>
<p>多核处理器提供了并行执行多个线程的能力。每个核心可以独立执行一个或多个线程</p>
<p>线程是CPU调度的最小单位, 可以通过多核调度实现线程并行处理</p>
<h4 id="守护线程了解吗">守护线程了解吗<a class="td-heading-self-link" href="#%e5%ae%88%e6%8a%a4%e7%ba%bf%e7%a8%8b%e4%ba%86%e8%a7%a3%e5%90%97" aria-label="Heading self-link"></a></h4>
<p>Java的线程分为两类
用户线程, 守护线程</p>
<p>守护线程默认的优先级比较低</p>
<ul>
<li>所有用户线程结束后守护线程自动结束</li>
<li>当所有用户线程结束后JVM停止, 不管守护线程是否结束</li>
<li>线程默认是非守护线程</li>
</ul>
<p>比如启动一个程序, main线程是用户线程, 同时还会启动垃圾回收线程等守护线程</p>
<h4 id="线程间有哪些通信方式">线程间有哪些通信方式?<a class="td-heading-self-link" href="#%e7%ba%bf%e7%a8%8b%e9%97%b4%e6%9c%89%e5%93%aa%e4%ba%9b%e9%80%9a%e4%bf%a1%e6%96%b9%e5%bc%8f" aria-label="Heading self-link"></a></h4>
<p>线程之间交换信息有如下方式</p>
<ul>
<li>使用共享对象, 修改同一个变量
比如 volatile syncroized 关键字
volatile 可以保证对共享变量的修改立刻对其他线程可见</li>
</ul>
<p>syncroized 可以保证临界区变量可见性, 和临界区的互斥访问</p>
<ul>
<li>使用 <code>wait()</code> <code>notify()</code> 同步方法</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @program: alog  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @description: 通信方式  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author: hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> **/</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">class</span> <span style="color:#e5c890">SharedObject</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//共享的消息  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> String message;  
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//判断标志  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">private</span> <span style="color:#e78284">boolean</span> hasMessage <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">false</span>;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">synchronized</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">writeMessage</span>(String message) <span style="color:#e78284">throws</span> InterruptedException {  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//线程不断监听是否消息被消费  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//这里逻辑是消息不被消费, 不写新的消息  </span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;writer loop&#34;</span>);  
</span></span><span style="display:flex;"><span>        Thread.<span style="color:#8caaee">sleep</span>(1000);  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">while</span> (hasMessage) {  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//有消息就等着消费  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">try</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//防止无意义的循环竞争, 直接等待  </span>
</span></span><span style="display:flex;"><span>                wait();  
</span></span><span style="display:flex;"><span>            } <span style="color:#ca9ee6">catch</span> (InterruptedException e) {  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//等的不耐烦了. 可能会需要强制中断  </span>
</span></span><span style="display:flex;"><span>                Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        Thread.<span style="color:#8caaee">sleep</span>(1000);  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//写消息  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">this</span>.<span style="color:#8caaee">message</span> <span style="color:#99d1db;font-weight:bold">=</span> message;  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//设置消息提醒  </span>
</span></span><span style="display:flex;"><span>        hasMessage <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">true</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//通知方法, 唤醒所有阻塞在obj的线程  </span>
</span></span><span style="display:flex;"><span>        notifyAll();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">synchronized</span> String <span style="color:#8caaee">readMessage</span>() <span style="color:#e78284">throws</span> InterruptedException {  
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//监听是否有消息读  </span>
</span></span><span style="display:flex;"><span>        Thread.<span style="color:#8caaee">sleep</span>(1000);  
</span></span><span style="display:flex;"><span>        System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;read loop&#34;</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">while</span> (<span style="color:#99d1db;font-weight:bold">!</span>hasMessage) {  
</span></span><span style="display:flex;"><span>            <span style="color:#737994;font-style:italic">//无消息则等  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">try</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//防止无意义的循环竞争, 直接等待  </span>
</span></span><span style="display:flex;"><span>                wait();  
</span></span><span style="display:flex;"><span>            } <span style="color:#ca9ee6">catch</span> (InterruptedException e) {  
</span></span><span style="display:flex;"><span>                Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        hasMessage <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">false</span>;  
</span></span><span style="display:flex;"><span>        notifyAll();  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span> message;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">class</span> <span style="color:#e5c890">twi</span> {  
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) <span style="color:#e78284">throws</span> InterruptedException {  
</span></span><span style="display:flex;"><span>            SharedObject sharedObject <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> SharedObject();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            Thread writer <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Thread(() <span style="color:#99d1db;font-weight:bold">-&gt;</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#ca9ee6">try</span> {  
</span></span><span style="display:flex;"><span>                    sharedObject.<span style="color:#8caaee">writeMessage</span>(<span style="color:#a6d189">&#34;Hello from Writer!&#34;</span>);  
</span></span><span style="display:flex;"><span>                } <span style="color:#ca9ee6">catch</span> (InterruptedException e) {  
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>            });  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            Thread reader <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Thread(() <span style="color:#99d1db;font-weight:bold">-&gt;</span> {  
</span></span><span style="display:flex;"><span>                String message <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">null</span>;  
</span></span><span style="display:flex;"><span>                <span style="color:#ca9ee6">try</span> {  
</span></span><span style="display:flex;"><span>                    message <span style="color:#99d1db;font-weight:bold">=</span> sharedObject.<span style="color:#8caaee">readMessage</span>();  
</span></span><span style="display:flex;"><span>                } <span style="color:#ca9ee6">catch</span> (InterruptedException e) {  
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>                System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(<span style="color:#a6d189">&#34;Reader received: &#34;</span> <span style="color:#99d1db;font-weight:bold">+</span> message);  
</span></span><span style="display:flex;"><span>            });  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            writer.<span style="color:#8caaee">start</span>();  
</span></span><span style="display:flex;"><span>            reader.<span style="color:#8caaee">start</span>();  
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#8caaee">sleep</span>(3000);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>线程的通信方法一般和锁一起使用, 实现线程的同步与通信</p>
<ul>
<li>使用<code>Exchanger</code>
<code>Exchanger</code> 是一个同步点, 可以在线程之间交换数据, 一个线程调用 <code>exchange()</code> 方法, 进入同步点, 等待就绪, 将数据传递给另一个线程, 同时接受另一个线程的数据</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @program: alog  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @description: 交换器  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> * @author: hamhuo  
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"> **/</span><span style="color:#e78284">class</span> <span style="color:#e5c890">FillAndEmpty</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">public</span> <span style="color:#e78284">static</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">main</span>(String<span style="color:#99d1db;font-weight:bold">[]</span> args) {  
</span></span><span style="display:flex;"><span>        Exchanger<span style="color:#99d1db;font-weight:bold">&lt;</span>String<span style="color:#99d1db;font-weight:bold">&gt;</span> ex <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Exchanger<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        Thread t <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Thread(() <span style="color:#99d1db;font-weight:bold">-&gt;</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">try</span>{  
</span></span><span style="display:flex;"><span>                String message <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;hello from star&#34;</span>;  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//这里会将message的内容做传递  </span>
</span></span><span style="display:flex;"><span>                String responce <span style="color:#99d1db;font-weight:bold">=</span> ex.<span style="color:#8caaee">exchange</span>(message);  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//执行到此, 代表传递完毕  </span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(responce <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;Earth&#34;</span>);  
</span></span><span style="display:flex;"><span>            }<span style="color:#ca9ee6">catch</span> (InterruptedException e){  
</span></span><span style="display:flex;"><span>                Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        });  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        Thread v <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> Thread(() <span style="color:#99d1db;font-weight:bold">-&gt;</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#ca9ee6">try</span>{  
</span></span><span style="display:flex;"><span>                String message <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;response from earth&#34;</span>;  
</span></span><span style="display:flex;"><span>                <span style="color:#737994;font-style:italic">//这里会将message的内容做传递  </span>
</span></span><span style="display:flex;"><span>                String responce <span style="color:#99d1db;font-weight:bold">=</span> ex.<span style="color:#8caaee">exchange</span>(message);  
</span></span><span style="display:flex;"><span>                System.<span style="color:#8caaee">out</span>.<span style="color:#8caaee">println</span>(responce <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;Alience&#34;</span>);  
</span></span><span style="display:flex;"><span>            }<span style="color:#ca9ee6">catch</span> (InterruptedException e){  
</span></span><span style="display:flex;"><span>                Thread.<span style="color:#8caaee">currentThread</span>().<span style="color:#8caaee">interrupt</span>();  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        });  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        t.<span style="color:#8caaee">start</span>();  
</span></span><span style="display:flex;"><span>        v.<span style="color:#8caaee">start</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>CompleteableFuture</code>
CompletableFuture 是 Java 8 引入的一个类，支持异步编程，允许线程在完成计算后将结果传递给其他线程。</li>
</ul>
<h4 id="sleep和wait的区别">sleep和wait的区别<a class="td-heading-self-link" href="#sleep%e5%92%8cwait%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>2/9</p></blockquote>
<p>sleep 使线程休眠, 但不会释放线程持有的锁, 是Thread类的方法
wait 使线程等待, 释放线程持有的锁, 是Object类的方法
使用条件不同
sleep 可以在任何位置调用
wait 只能在同步代码块, 同步静态方法, 同步类中使用, 这是因为使用wait()的前提是线程持有当前对象的锁
唤醒方式不同
sleep 后线程进入 TIMED_WAITING状态, 计时结束后自动唤醒
wait 后线程进入 WAITING状态, 必须由其他线程调用notify/ notifyAll 方法唤醒</p>
<h3 id="你在工作中用到过-threadlocal-吗">你在工作中用到过 ThreadLocal 吗？<a class="td-heading-self-link" href="#%e4%bd%a0%e5%9c%a8%e5%b7%a5%e4%bd%9c%e4%b8%ad%e7%94%a8%e5%88%b0%e8%bf%87-threadlocal-%e5%90%97" aria-label="Heading self-link"></a></h3>
<p>存储用户信息</p>
<p>用户在请求头携带token, 控制层根据token解析出用户的基本信息</p>
<p>如果在服务层需要调用用户信息, 就可以把信息存入 ThreadLocal 跨方法调用</p>
<h3 id="threadlocal-怎么实现的呢">ThreadLocal 怎么实现的呢?<a class="td-heading-self-link" href="#threadlocal-%e6%80%8e%e4%b9%88%e5%ae%9e%e7%8e%b0%e7%9a%84%e5%91%a2" aria-label="Heading self-link"></a></h3>
<p>//弱引用
//ThreadLocal原理
//内存泄露</p>
<p><code>ThreadLocal</code> 本身不存储任何值, 只是作为一个映射, 来映射线程的局部变量</p>
<p>其中的 set get 方法 是访问线程自己的 <code>ThreadLocalMap</code></p>
<p>Map 内部维护了一个 Entry数组, 该数组继承了弱引用, 使得内存不足自动触发GC时, 会回收 ThreadLocal对象, 防止内存泄露</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">static</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">Entry</span> <span style="color:#e78284">extends</span> WeakReference<span style="color:#99d1db;font-weight:bold">&lt;</span>ThreadLocal<span style="color:#99d1db;font-weight:bold">&lt;?&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">/** The value associated with this ThreadLocal. */</span>
</span></span><span style="display:flex;"><span>    Object value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">//节点类</span>
</span></span><span style="display:flex;"><span>    Entry(ThreadLocal<span style="color:#99d1db;font-weight:bold">&lt;?&gt;</span> k, Object v) {
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//key赋值</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e78284">super</span>(k);
</span></span><span style="display:flex;"><span>        <span style="color:#737994;font-style:italic">//value赋值</span>
</span></span><span style="display:flex;"><span>        value <span style="color:#99d1db;font-weight:bold">=</span> v;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="threadlocal的内存泄露">ThreadLocal的内存泄露<a class="td-heading-self-link" href="#threadlocal%e7%9a%84%e5%86%85%e5%ad%98%e6%b3%84%e9%9c%b2" aria-label="Heading self-link"></a></h4>
<p>ThreadLocal 设计为弱引用使得内存不足而触发GC时会被回收
但是当线程一直运行, 并且Entry.value 一直被强引用到某个对象就会造成无法回收, 使得内存泄露</p>
<p>这就需要使用完ThreadLocal后, 在finally调用 remove() 释放内存空间</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ca9ee6">try</span> {
</span></span><span style="display:flex;"><span>    threadLocal.<span style="color:#8caaee">set</span>(value);
</span></span><span style="display:flex;"><span>    <span style="color:#737994;font-style:italic">// 执行业务操作</span>
</span></span><span style="display:flex;"><span>} <span style="color:#ca9ee6">finally</span> {
</span></span><span style="display:flex;"><span>    threadLocal.<span style="color:#8caaee">remove</span>(); <span style="color:#737994;font-style:italic">// 确保能够执行清理</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="threadlocalmap-的源码看过吗"><code>ThreadLocalMap</code> 的源码看过吗？<a class="td-heading-self-link" href="#threadlocalmap-%e7%9a%84%e6%ba%90%e7%a0%81%e7%9c%8b%e8%bf%87%e5%90%97" aria-label="Heading self-link"></a></h3>
<p>ThreadLocalMap 是 ThreadLocal的核心数据结构
是键值对格式的, 关注两个问题</p>
<ol>
<li>元素数组</li>
<li>散列方法
map中维护了一个Entry[] 数组, key是每个线程的ThreadLocal对象, value就是对应的隔离变量</li>
</ol>
<p>为了保证entry[] 放入时散布均匀, 保证性能, Map使用哈希取余法, 取出threadlocal的哈希码, 和数组长度取余, 哈希码的生成使用黄金分割数, 每生成一个ThreadLocal对象, 就会使hash增加, 好处就是hash分布的均匀</p>
<h4 id="java内存模型的理解">Java内存模型的理解<a class="td-heading-self-link" href="#java%e5%86%85%e5%ad%98%e6%a8%a1%e5%9e%8b%e7%9a%84%e7%90%86%e8%a7%a3" aria-label="Heading self-link"></a></h4>

	
</div>


          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://example.org/twitter" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Stack Overflow" aria-label="Stack Overflow">
    <a target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Developer mailing list" aria-label="Developer mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025&ndash;2025
    <span class="td-footer__authors">海阔知识库 | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script defer src="/js/click-to-copy.js" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>