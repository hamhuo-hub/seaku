<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="http://localhost:1313/docs/advanced/">
<link rel="alternate" type="application/rss&#43;xml" href="http://localhost:1313/docs/advanced/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Java进阶能力 | 海阔集</title>
<meta name="description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis 中间件 消息队列 什么是中间件? 为什么要用?
维基百科这样说
中间件（英语：Middleware），又译中间件、中介层，是一类提供系统软件和应用软件之间连接、便于软件各部件之间的沟通的软件，应用软件可以借助中间件在不同的技术架构之间共享信息与资源。中间件位于客户机服务器的操作系统之上，管理着计算资源和网络通信。
简单来说：中间件就是一类为应用软件服务的软件，应用软件是为用户服务的，用户不会接触或者使用到中间件。
中间件有 RPC 框架、消息队列、MQ 分布式组件、HTTP 服务器、任务调度框架、配置中心、数据库层的分库分表工具和数据迁移工具等等。
几个容易混淆的概念
二方/三方的工具不是中间件, 这些工具包是在各种开发场景中沉淀的一些工具类集合, 本质也是代码的一部分 业务平台不是中间件，业务平台是从服务的视角抽象的能同时支撑多个业务，业务之间的信息能形成交互和增强的平台。 总之, 中间件是系统软件和应用软件之间, 软件与各部件之间, 管理客户机与系统软件之间的计算资源和网络通信服务于用户但用户不可见的软件">
<meta property="og:url" content="http://localhost:1313/docs/advanced/">
  <meta property="og:site_name" content="海阔集">
  <meta property="og:title" content="Java进阶能力">
  <meta property="og:description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis 中间件 消息队列 什么是中间件? 为什么要用?
维基百科这样说
中间件（英语：Middleware），又译中间件、中介层，是一类提供系统软件和应用软件之间连接、便于软件各部件之间的沟通的软件，应用软件可以借助中间件在不同的技术架构之间共享信息与资源。中间件位于客户机服务器的操作系统之上，管理着计算资源和网络通信。
简单来说：中间件就是一类为应用软件服务的软件，应用软件是为用户服务的，用户不会接触或者使用到中间件。
中间件有 RPC 框架、消息队列、MQ 分布式组件、HTTP 服务器、任务调度框架、配置中心、数据库层的分库分表工具和数据迁移工具等等。
几个容易混淆的概念
二方/三方的工具不是中间件, 这些工具包是在各种开发场景中沉淀的一些工具类集合, 本质也是代码的一部分 业务平台不是中间件，业务平台是从服务的视角抽象的能同时支撑多个业务，业务之间的信息能形成交互和增强的平台。 总之, 中间件是系统软件和应用软件之间, 软件与各部件之间, 管理客户机与系统软件之间的计算资源和网络通信服务于用户但用户不可见的软件">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Java进阶能力">
  <meta itemprop="description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis 中间件 消息队列 什么是中间件? 为什么要用?
维基百科这样说
中间件（英语：Middleware），又译中间件、中介层，是一类提供系统软件和应用软件之间连接、便于软件各部件之间的沟通的软件，应用软件可以借助中间件在不同的技术架构之间共享信息与资源。中间件位于客户机服务器的操作系统之上，管理着计算资源和网络通信。
简单来说：中间件就是一类为应用软件服务的软件，应用软件是为用户服务的，用户不会接触或者使用到中间件。
中间件有 RPC 框架、消息队列、MQ 分布式组件、HTTP 服务器、任务调度框架、配置中心、数据库层的分库分表工具和数据迁移工具等等。
几个容易混淆的概念
二方/三方的工具不是中间件, 这些工具包是在各种开发场景中沉淀的一些工具类集合, 本质也是代码的一部分 业务平台不是中间件，业务平台是从服务的视角抽象的能同时支撑多个业务，业务之间的信息能形成交互和增强的平台。 总之, 中间件是系统软件和应用软件之间, 软件与各部件之间, 管理客户机与系统软件之间的计算资源和网络通信服务于用户但用户不可见的软件">
  <meta itemprop="dateModified" content="2025-02-11T00:25:32+08:00">
  <meta itemprop="wordCount" content="36">
  <meta itemprop="keywords" content="消息队列,Redis">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Java进阶能力">
  <meta name="twitter:description" content="内容来源:
沉默王二 GitHub 上开源的知识库《Java 进阶之路》 rabbitMQ JavaGuide 知乎-阿里大淘宝 Java进阶能力 Java作为一门编程语言, 需要和其他组件一起完成某个项目 一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码
Redis 中间件 消息队列 什么是中间件? 为什么要用?
维基百科这样说
中间件（英语：Middleware），又译中间件、中介层，是一类提供系统软件和应用软件之间连接、便于软件各部件之间的沟通的软件，应用软件可以借助中间件在不同的技术架构之间共享信息与资源。中间件位于客户机服务器的操作系统之上，管理着计算资源和网络通信。
简单来说：中间件就是一类为应用软件服务的软件，应用软件是为用户服务的，用户不会接触或者使用到中间件。
中间件有 RPC 框架、消息队列、MQ 分布式组件、HTTP 服务器、任务调度框架、配置中心、数据库层的分库分表工具和数据迁移工具等等。
几个容易混淆的概念
二方/三方的工具不是中间件, 这些工具包是在各种开发场景中沉淀的一些工具类集合, 本质也是代码的一部分 业务平台不是中间件，业务平台是从服务的视角抽象的能同时支撑多个业务，业务之间的信息能形成交互和增强的平台。 总之, 中间件是系统软件和应用软件之间, 软件与各部件之间, 管理客户机与系统软件之间的计算资源和网络通信服务于用户但用户不可见的软件">
<link href="/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="800" height="800" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23.3 8.40007 21.82 6.40008C21.7248 6.27314 21.6008 6.17066 21.4583 6.10111 21.3157 6.03156 21.1586 5.99693 21 6.00008H11.2C11.0555 6.00007 10.9128 6.03135 10.7816 6.09177 10.6504 6.15219 10.5339 6.24031 10.44 6.35007L8.71998 8.35008C8.57227 8.53401 8.49435 8.76424 8.49998 9.00008V16.2901C8.50262 18.0317 9.19567 19.7013 10.4272 20.9328c1.2316 1.2316 2.9011 1.9246 4.6428 1.9273h1.86C18.6716 22.8574 20.3412 22.1644 21.5728 20.9328c1.2315-1.2315 1.9245-2.9011 1.9272-4.6427V9.00008C23.5 8.7837 23.4298 8.57317 23.3 8.40007z" fill="#ffcc80"/><path d="M29.78 28.38l-4-5C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38z" fill="#01579b"/><path d="M29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344L15.73 11.6C15.906 11.6534 16.094 11.6534 16.27 11.6l13-3.59997C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003z" fill="#01579b"/><path d="M11.22 6C11.0756 5.99999 10.9328 6.03127 10.8016 6.09169 10.6704 6.15211 10.5539 6.24023 10.46 6.35l-1.72 2C8.58509 8.53114 8.49998 8.76166 8.5 9v7.29C8.50264 18.0317 9.19569 19.7012 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272H16V6H11.22z" fill="#ffe0b2"/><path d="M7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H16V25L7.21999 23z" fill="#0277bd"/><path d="M15.71 2.00002l-13 4C2.49742 6.06422 2.31226 6.19734 2.1837 6.3784c-.12855.18107-.19318.39977-.1837.62162C1.9917 7.22447 2.0592 7.44518 2.19163 7.62658 2.32405 7.80799 2.5137 7.93954 2.73 8.00002L15.73 11.6C15.8194 11.6146 15.9106 11.6146 16 11.6V2.00002C15.9039 1.98469 15.8061 1.98469 15.71 2.00002z" fill="#0277bd"/><path d="M2.73 8.00003l5.77 1.56V16.29C8.50264 18.0317 9.19569 19.7013 10.4272 20.9328c1.2316 1.2315 2.9011 1.9246 4.6428 1.9272h1.86C18.6717 22.8574 20.3412 22.1643 21.5728 20.9328c1.2315-1.2315 1.9246-2.9011 1.9272-4.6428V9.56003l5.77-1.56C29.4863 7.93954 29.6759 7.80799 29.8084 7.62659 29.9408 7.44518 30.0083 7.22447 30 7.00003 30.0095 6.77817 29.9448 6.55947 29.8163 6.37841 29.6877 6.19735 29.5026 6.06422 29.29 6.00003l-13-4C16.0999 1.95002 15.9001 1.95002 15.71 2.00003l-13 4c-.21258.06419-.39774.19732-.5263.37838C2.05515 6.55947 1.99052 6.77817 2 7.00003 1.9917 7.22447 2.0592 7.44518 2.19163 7.62659c.13242.1814.32207.31295.53837.37344zM21.5 16.29C21.4974 17.5013 21.015 18.6621 20.1586 19.5186 19.3021 20.3751 18.1412 20.8574 16.93 20.86H15.07C13.8588 20.8574 12.6979 20.3751 11.8414 19.5186 10.985 18.6621 10.5026 17.5013 10.5 16.29V10.11l5.23 1.45C15.906 11.6134 16.094 11.6134 16.27 11.56l5.23-1.45v6.18zM16 4.05003l9.44 2.95-9.44 2.56-9.44-2.56 9.44-2.95z" fill="#263238"/><path d="M25.78 23.38C25.664 23.2321 25.5086 23.1198 25.3318 23.0562 25.1549 22.9925 24.9637 22.98 24.78 23.02L16 25 7.21999 23C7.03632 22.96 6.84507 22.9725 6.6682 23.0362 6.49133 23.0998 6.33598 23.2121 6.21999 23.36l-4 5C2.10392 28.5064 2.03116 28.6823 2.00995 28.8679 1.98874 29.0534 2.01993 29.2413 2.09999 29.41 2.17815 29.5839 2.3044 29.7319 2.46385 29.8364 2.62331 29.9409 2.80933 29.9977 2.99999 30H29C29.1885 29.9995 29.373 29.9457 29.5322 29.8448 29.6914 29.744 29.8189 29.6002 29.9 29.43 29.98 29.2613 30.0112 29.0734 29.99 28.8879 29.9688 28.7023 29.8961 28.5264 29.78 28.38l-4-5zM5.07999 28l2.31-2.89L15.78 27C15.9251 27.0299 16.0748 27.0299 16.22 27l8.39-1.87L26.92 28H5.07999z" fill="#263238"/></svg></span><span class="navbar-brand__name">海阔集</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/leetcode/"><span>Alog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/docs/"><span>Doc</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/interview/"><span>Interview</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/advanced/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Java进阶能力</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-c0333df9693e95d8b4a6758f9073b505">JWT</a></li>


    
  
    
    
	
<li>2: <a href="#pg-c7748db182c095cbf3afbf54e91a9dde">TTL</a></li>


    
  
    
    
	
<li>3: <a href="#pg-6584a1863892ecb310dc02695588346c">响应式编程Reactor库</a></li>


    
  
    
    
	
<li>4: <a href="#pg-a4d375d70ef2ae9ea76600983dbac534">消息队列</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-1338051e553f7921513994e5ccdc2d82"></a></li>


    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-9d099c622fce08014808a438406a5b28">网关Gateway</a></li>


    
  
    
    
	
<li>6: <a href="#pg-ca7712bf275374a77e97a3daa3f2c97c"></a></li>


    
  

    </ul>


<div class="content">
      <p>内容来源:</p>
<ul>
<li>沉默王二 GitHub 上开源的知识库《<a href="https://github.com/itwanger/toBeBetterJavaer">Java 进阶之路</a>》</li>
<li><a href="https://www.rabbitmq.com/tutorials">rabbitMQ</a></li>
<li><a href="https://javaguide.cn/">JavaGuide</a></li>
<li><a href="https://www.zhihu.com/question/19730582/answer/1663627873">知乎-阿里大淘宝</a></li>
</ul>
<p>Java进阶能力
Java作为一门编程语言, 需要和其他组件一起完成某个项目
一名好的程序员不仅要知道去哪里import, 更要知道import什么组件, 甚至为组件贡献代码</p>
<ul>
<li>Redis</li>
<li>中间件
<ul>
<li>消息队列</li>
</ul>
</li>
</ul>
<p>什么是中间件? 为什么要用?</p>
<p>维基百科这样说</p>
<blockquote>
<p>中间件（英语：Middleware），又译中间件、中介层，是一类提供系统软件和应用软件之间连接、便于软件各部件之间的沟通的软件，应用软件可以借助中间件在不同的技术架构之间共享信息与资源。中间件位于客户机服务器的操作系统之上，管理着计算资源和网络通信。</p></blockquote>
<p>简单来说：<strong>中间件就是一类为应用软件服务的软件，应用软件是为用户服务的，用户不会接触或者使用到中间件。</strong></p>
<p>中间件有 RPC 框架、消息队列、MQ 分布式组件、HTTP 服务器、任务调度框架、配置中心、数据库层的分库分表工具和数据迁移工具等等。</p>
<p>几个容易混淆的概念</p>
<ol>
<li>二方/三方的工具不是中间件, 这些工具包是在各种开发场景中沉淀的一些工具类集合, 本质也是代码的一部分</li>
<li>业务平台不是中间件，业务平台是从服务的视角抽象的能同时支撑多个业务，业务之间的信息能形成交互和增强的平台。</li>
</ol>
<p>总之, 中间件是系统软件和应用软件之间, 软件与各部件之间, 管理客户机与系统软件之间的计算资源和网络通信服务于用户但用户不可见的软件</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c0333df9693e95d8b4a6758f9073b505">1 - JWT</h1>
    
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c7748db182c095cbf3afbf54e91a9dde">2 - TTL</h1>
    <div class="lead">基于 TransmittableThreadLocal (TTL) 自定义请求头拦截器，将Header 数据封装到线程变量中方便获取，减少用户信息数据库查询次数，同时验证当前用户有效期自动刷新有效期。</div>
	<p><code>TransmittableThreadLocal</code> (TTL) 是增强版的 <code>ThreadLocal</code></p>
<blockquote>
<p>前置:
<a href="ThreadLocal"><code>ThreadLocal</code></a></p></blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6584a1863892ecb310dc02695588346c">3 - 响应式编程Reactor库</h1>
    
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a4d375d70ef2ae9ea76600983dbac534">4 - 消息队列</h1>
    <div class="lead">消息中间件是指利用高效可靠的消息传递机制进行与平台无关的数据交流，并基于数据通信来进行分布式系统的构建。消息中间件是分布式系统中重要的组件，主要解决应用解耦，异步消息，流量削峰等问题，实现高性能，高可用，可伸缩和最终一致性的系统架构。</div>
	<p><a href="https://developer.aliyun.com/article/953777">https://developer.aliyun.com/article/953777</a></p>
<h4 id="什么是消息队列">什么是消息队列<a class="td-heading-self-link" href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97" aria-label="Heading self-link"></a></h4>
<p>消息队列（Message Queue，简称MQ）指保存消息的一个容器，其实本质就是一个保存数据的队列。</p>
<p>消息中间件是指利用高效可靠的消息传递机制进行与平台无关的数据交流，并基于数据通信来进行分布式系统的构建。
消息中间件是分布式系统中重要的组件，主要解决应用解耦，异步消息，流量削峰等问题，实现高性能，高可用，可伸缩和最终一致性的系统架构。</p>
<p>可以理解为: 消息队列, 分布式做异步通信, 流量削峰, 服务解耦的重要角色</p>
<p>平滑处理: 放到缓存, 依次处理, 实现削峰填谷, 消息中间件可以通过缓存请求，避免系统崩
溃。</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1338051e553f7921513994e5ccdc2d82">4.1 - </h1>
    
	
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9d099c622fce08014808a438406a5b28">5 - 网关Gateway</h1>
    <div class="lead">网关是一个位于微服务架构前端的组件，它充当了所有微服务的入口</div>
	<h4 id="什么是网关">什么是网关<a class="td-heading-self-link" href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%bd%91%e5%85%b3" aria-label="Heading self-link"></a></h4>
<p>网关负责路由请求、负载均衡、安全认证、流量控制、监控和日志记录等任务。</p>
<p>我的理解是, 网关是请求真正进入服务前的过滤, 管理, 控制(重定向), 可以理解为保安大哥</p>
<p>网关的结构</p>
<ul>
<li>
<p>路由
网关的基本模块, 由断言和过滤器组成</p>
<ul>
<li>
<p>断言
匹配规则, 当请求路径匹配时允许路由到相关服务
实现一组匹配规则，让请求找到对应的 Route 进行处理</p>
</li>
<li>
<p>过滤器
响应式的过滤器链, 实现请求的过滤</p>
<ul>
<li>全局过滤器
全局过滤器作用于所有的路由，不需要单独配置</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hamhuo-hub/HamPic/img/img/20250212093859168.png" alt="image.png"></p>
<p>客户端发起请求, 由 <code>Gateway Handler Mapping</code>
接收, 这里执行断言并路由到 <code>Gateway Web Handler</code> 这里做过滤链, 过滤请求, 最后传递给服务
过滤器可以在执行前和执行后回调</p>
<blockquote>
<p>在“pre”类型的过滤器可以做参数校验、权限校验、流量监控、日志输出、协议转换等;</p>
<p>在“post”类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流量监控等有着非常重要的作用。</p></blockquote>
<blockquote>
<p>了解:
<a href="/docs/advanced/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8Breactor%E5%BA%93/">响应式编程</a></p></blockquote>
<h4 id="自定义网关实现全局过滤器">自定义网关实现全局过滤器<a class="td-heading-self-link" href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e7%bd%91%e5%85%b3%e5%ae%9e%e7%8e%b0%e5%85%a8%e5%b1%80%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="Heading self-link"></a></h4>
<p>网关选型<code>SpringCloudGateway</code></p>
<p>模板工程基于 <code>pmhub</code></p>
<p>新建自定义的全局过滤器</p>
<p>全局过滤器需要实现 <code>GlobalFilter</code>
过滤器需要确定执行顺序, 实现<code>Order</code> 接口</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered
</span></span></code></pre></div><p>该过滤器实现如下功能</p>
<ol>
<li>请求耗时记录</li>
<li>白名单过滤</li>
<li>Token鉴权</li>
<li>日志输出</li>
</ol>
<p>请求耗时记录:</p>
<p>全局过滤器的优先级较高, 因此把请求进入过滤器的时间作为起点, 业务执行完毕执行<code>post</code> 业务逻辑. 进行简单的时间相减</p>
<p>白名单过滤:</p>
<p><a href="/docs/advanced/nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"><code>nacos</code></a> 配置白名单, 有些路径不需要严格的鉴权, 比如首页. 所有人发请求都能通过, 就直接跳过完事</p>
<p><code>Token</code>鉴权:</p>
<p>作为全局过滤器, 当用户请求进入应当进行身份鉴权, 过滤无效的请求
从请求头里拿 <code>Token</code> , 跟缓存做匹配即可</p>
<blockquote>
<p><code>Redis</code> 策略是到期销毁, 不做更新</p></blockquote>
<p>日志输出:
在过滤链回调后执行, 代表服务执行完成
结束时间减去开始时间就行</p>
<p>为了方便解释, 我们一项项实现</p>
<p>请求耗时:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered{
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//常量, 记录开始访问的时间</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> String BEGIN_VISIT_TIME <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;begin_visit_time&#34;</span>;<span style="color:#737994;font-style:italic">//开始访问时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上日志</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Logger log <span style="color:#99d1db;font-weight:bold">=</span> LoggerFactory.<span style="color:#8caaee">getLogger</span>(AuthFilter.<span style="color:#8caaee">class</span>);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//过滤器接口方法</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> Mono<span style="color:#99d1db;font-weight:bold">&lt;</span>Void<span style="color:#99d1db;font-weight:bold">&gt;</span> <span style="color:#8caaee">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//token和白名单稍后实现</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//在上下文加上开始时间</span>
</span></span><span style="display:flex;"><span>	exchange.<span style="color:#8caaee">getAttributes</span>().<span style="color:#8caaee">put</span>(BEGIN_VISIT_TIME, System.<span style="color:#8caaee">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//等待链执行完成回调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange)
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//链式调用then, 使用Mono.fromRunnable方法顺序执行日志输出</span>
</span></span><span style="display:flex;"><span>	.<span style="color:#8caaee">then</span>(Mono.<span style="color:#8caaee">fromRunnable</span>{})
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">//日志输出的逻辑</span>
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">// 记录接口访问日志  </span>
</span></span><span style="display:flex;"><span>		Long beginVisitTime <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getAttribute</span>(BEGIN_VISIT_TIME);
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> (beginVisitTime <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>){
</span></span><span style="display:flex;"><span>			logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;duration&#34;</span>, (System.<span style="color:#8caaee">currentTimeMillis</span>() <span style="color:#99d1db;font-weight:bold">-</span> beginVisitTime) <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;ms&#34;</span>);
</span></span><span style="display:flex;"><span>			log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;访问接口信息: {}&#34;</span>, logData);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>白名单过滤</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered{
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//常量, 记录开始访问的时间</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> String BEGIN_VISIT_TIME <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;begin_visit_time&#34;</span>;<span style="color:#737994;font-style:italic">//开始访问时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上日志</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Logger log <span style="color:#99d1db;font-weight:bold">=</span> LoggerFactory.<span style="color:#8caaee">getLogger</span>(AuthFilter.<span style="color:#8caaee">class</span>);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//过滤器接口方法</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> Mono<span style="color:#99d1db;font-weight:bold">&lt;</span>Void<span style="color:#99d1db;font-weight:bold">&gt;</span> <span style="color:#8caaee">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//白名单</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//首先拿到请求路径</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//上下文拿请求</span>
</span></span><span style="display:flex;"><span>	ServerHttpRequest request <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getRequest</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//请求拿请求路径, 先拿URI, 再去掉首部</span>
</span></span><span style="display:flex;"><span>	String url <span style="color:#99d1db;font-weight:bold">=</span> request.<span style="color:#8caaee">getURI</span>().<span style="color:#8caaee">getPath</span>();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// 跳过不需要验证的路径, 直接进下一级</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">matches</span>(url, ignoreWhite.<span style="color:#8caaee">getWhites</span>())) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//在上下文加上开始时间</span>
</span></span><span style="display:flex;"><span>	exchange.<span style="color:#8caaee">getAttributes</span>().<span style="color:#8caaee">put</span>(BEGIN_VISIT_TIME, System.<span style="color:#8caaee">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//等待链执行完成回调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange)
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//链式调用then, 使用Mono.fromRunnable方法顺序执行日志输出</span>
</span></span><span style="display:flex;"><span>	.<span style="color:#8caaee">then</span>(Mono.<span style="color:#8caaee">fromRunnable</span>{})
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">//日志输出的逻辑</span>
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">// 记录接口访问日志  </span>
</span></span><span style="display:flex;"><span>		Long beginVisitTime <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getAttribute</span>(BEGIN_VISIT_TIME);
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> (beginVisitTime <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>){
</span></span><span style="display:flex;"><span>			logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;duration&#34;</span>, (System.<span style="color:#8caaee">currentTimeMillis</span>() <span style="color:#99d1db;font-weight:bold">-</span> beginVisitTime) <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;ms&#34;</span>);
</span></span><span style="display:flex;"><span>			log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;访问接口信息: {}&#34;</span>, logData);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>token鉴权:
选型 <a href="/docs/advanced/jwt/"><code>Jwt</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8caaee;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">public</span> <span style="color:#e78284">class</span> <span style="color:#e5c890">AuthFilter</span> <span style="color:#e78284">implements</span> GlobalFilter, Ordered{
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//常量, 记录开始访问的时间</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> String BEGIN_VISIT_TIME <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;begin_visit_time&#34;</span>;<span style="color:#737994;font-style:italic">//开始访问时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上日志</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> <span style="color:#e78284">static</span> <span style="color:#e78284">final</span> Logger log <span style="color:#99d1db;font-weight:bold">=</span> LoggerFactory.<span style="color:#8caaee">getLogger</span>(AuthFilter.<span style="color:#8caaee">class</span>);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//补上redis</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Autowired</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">private</span> RedisService redisService;
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">//过滤器接口方法</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8caaee;font-weight:bold">@Override</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">public</span> Mono<span style="color:#99d1db;font-weight:bold">&lt;</span>Void<span style="color:#99d1db;font-weight:bold">&gt;</span> <span style="color:#8caaee">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//白名单</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//首先拿到请求路径</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//上下文拿请求</span>
</span></span><span style="display:flex;"><span>	ServerHttpRequest request <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getRequest</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//请求拿请求路径, 先拿URI, 再去掉首部</span>
</span></span><span style="display:flex;"><span>	String url <span style="color:#99d1db;font-weight:bold">=</span> request.<span style="color:#8caaee">getURI</span>().<span style="color:#8caaee">getPath</span>();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// 跳过不需要验证的路径, 直接进下一级, 返回链的执行结果</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">matches</span>(url, ignoreWhite.<span style="color:#8caaee">getWhites</span>())) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//剩下的请求过筛子</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//从请求拿token</span>
</span></span><span style="display:flex;"><span>	String token <span style="color:#99d1db;font-weight:bold">=</span> getToken(request);
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">isEmpty</span>(token)) {  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;令牌不能为空&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//拿JWT的声明, 这里写了一个字符串工具拿声明, 令牌秘钥就在工具里</span>
</span></span><span style="display:flex;"><span>	Claims claims <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">parseToken</span>(token);
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (claims <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;令牌已过期或验证不正确！&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//从声明拿用户ID</span>
</span></span><span style="display:flex;"><span>	String userkey <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">getUserKey</span>(claims);  
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//从缓存匹配用户ID的token, 这里getTokenKey格式化, 就加了个前缀</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">boolean</span> islogin <span style="color:#99d1db;font-weight:bold">=</span> redisService.<span style="color:#8caaee">hasKey</span>(getTokenKey(userkey));
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (<span style="color:#99d1db;font-weight:bold">!</span>islogin) {  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;登录状态已过期&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//最后从声明拿用户详细信息</span>
</span></span><span style="display:flex;"><span>	String userid <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">getUserId</span>(claims);  
</span></span><span style="display:flex;"><span>	String username <span style="color:#99d1db;font-weight:bold">=</span> JwtUtils.<span style="color:#8caaee">getUserName</span>(claims);  
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">if</span> (StringUtils.<span style="color:#8caaee">isEmpty</span>(userid) <span style="color:#99d1db;font-weight:bold">||</span> StringUtils.<span style="color:#8caaee">isEmpty</span>(username)) {  
</span></span><span style="display:flex;"><span>	    <span style="color:#ca9ee6">return</span> unauthorizedResponse(exchange, <span style="color:#a6d189">&#34;令牌验证失败&#34;</span>);  
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//重新设置请求, 鉴权完毕</span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//设置用户信息到请求  </span>
</span></span><span style="display:flex;"><span>	addHeader(mutate, SecurityConstants.<span style="color:#8caaee">USER_KEY</span>, userkey);  
</span></span><span style="display:flex;"><span>	addHeader(mutate, SecurityConstants.<span style="color:#8caaee">DETAILS_USER_ID</span>, userid);  
</span></span><span style="display:flex;"><span>	addHeader(mutate, SecurityConstants.<span style="color:#8caaee">DETAILS_USERNAME</span>, username);  
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// 内部请求来源参数清除（防止网关携带内部请求标识，造成系统安全风险）  </span>
</span></span><span style="display:flex;"><span>	removeHeader(mutate, SecurityConstants.<span style="color:#8caaee">FROM_SOURCE</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//在上下文加上开始时间</span>
</span></span><span style="display:flex;"><span>	exchange.<span style="color:#8caaee">getAttributes</span>().<span style="color:#8caaee">put</span>(BEGIN_VISIT_TIME, System.<span style="color:#8caaee">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//等待链执行完成回调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> chain.<span style="color:#8caaee">filter</span>(exchange)
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">//链式调用then, 使用Mono.fromRunnable方法顺序执行日志输出</span>
</span></span><span style="display:flex;"><span>	.<span style="color:#8caaee">then</span>(Mono.<span style="color:#8caaee">fromRunnable</span>{})
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">//日志输出的逻辑</span>
</span></span><span style="display:flex;"><span>		<span style="color:#737994;font-style:italic">// 记录接口访问日志  </span>
</span></span><span style="display:flex;"><span>		Long beginVisitTime <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getAttribute</span>(BEGIN_VISIT_TIME);  
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> (beginVisitTime <span style="color:#99d1db;font-weight:bold">!=</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>		    URI uri <span style="color:#99d1db;font-weight:bold">=</span> exchange.<span style="color:#8caaee">getRequest</span>().<span style="color:#8caaee">getURI</span>();  
</span></span><span style="display:flex;"><span>		    Map<span style="color:#99d1db;font-weight:bold">&lt;</span>String, Object<span style="color:#99d1db;font-weight:bold">&gt;</span> logData <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">new</span> HashMap<span style="color:#99d1db;font-weight:bold">&lt;&gt;</span>();  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;host&#34;</span>, uri.<span style="color:#8caaee">getHost</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;port&#34;</span>, uri.<span style="color:#8caaee">getPort</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;path&#34;</span>, uri.<span style="color:#8caaee">getPath</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;query&#34;</span>, uri.<span style="color:#8caaee">getRawQuery</span>());  
</span></span><span style="display:flex;"><span>		    logData.<span style="color:#8caaee">put</span>(<span style="color:#a6d189">&#34;duration&#34;</span>, (System.<span style="color:#8caaee">currentTimeMillis</span>() <span style="color:#99d1db;font-weight:bold">-</span> beginVisitTime) <span style="color:#99d1db;font-weight:bold">+</span> <span style="color:#a6d189">&#34;ms&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>		    log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;访问接口信息: {}&#34;</span>, logData);  
</span></span><span style="display:flex;"><span>		    log.<span style="color:#8caaee">info</span>(<span style="color:#a6d189">&#34;我是美丽分割线: ###################################################&#34;</span>);  
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>addHeader</code> 和 <code>removeHeader</code> 其实没什么说的, 就是重新构造了个请求, 方便后续服务直接拿信息</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">addHeader</span>(ServerHttpRequest.<span style="color:#8caaee">Builder</span> mutate, String name, Object value) {  
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">if</span> (value <span style="color:#99d1db;font-weight:bold">==</span> <span style="color:#ef9f76">null</span>) {  
</span></span><span style="display:flex;"><span>        <span style="color:#ca9ee6">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    String valueStr <span style="color:#99d1db;font-weight:bold">=</span> value.<span style="color:#8caaee">toString</span>();  
</span></span><span style="display:flex;"><span>    String valueEncode <span style="color:#99d1db;font-weight:bold">=</span> ServletUtils.<span style="color:#8caaee">urlEncode</span>(valueStr);  
</span></span><span style="display:flex;"><span>    mutate.<span style="color:#8caaee">header</span>(name, valueEncode);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#e78284">private</span> <span style="color:#e78284">void</span> <span style="color:#8caaee">removeHeader</span>(ServerHttpRequest.<span style="color:#8caaee">Builder</span> mutate, String name) {  
</span></span><span style="display:flex;"><span>    mutate.<span style="color:#8caaee">headers</span>(httpHeaders <span style="color:#99d1db;font-weight:bold">-&gt;</span> httpHeaders.<span style="color:#8caaee">remove</span>(name)).<span style="color:#8caaee">build</span>();  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ca7712bf275374a77e97a3daa3f2c97c">6 - </h1>
    
	
</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://example.org/twitter" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Stack Overflow" aria-label="Stack Overflow">
    <a target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Developer mailing list" aria-label="Developer mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025&ndash;2025
    <span class="td-footer__authors">海阔知识库 | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script defer src="/js/click-to-copy.js" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
